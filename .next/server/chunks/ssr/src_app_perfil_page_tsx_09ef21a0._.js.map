{"version":3,"sources":["turbopack:///[project]/src/app/perfil/page.tsx","turbopack:///[project]/src/data/trofeosPremiumImport.ts","turbopack:///[project]/src/utils/premios-mensuales.ts","turbopack:///[project]/src/utils/chat.ts"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { renderNick } from \"@/utils/renderNick\";\r\nimport { TROFEOS_PREMIUM } from \"@/data/trofeosPremiumImport\";\r\nimport { useTranslation } from \"@/utils/i18n\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { PremiosMensualesAPI } from \"@/utils/premios-mensuales\";\r\nimport { ConcursosAPI } from \"@/utils/concursos\";\r\nimport { ChatAPI } from \"@/utils/chat\";\r\nimport { UsersAPI, User } from \"../../utils/users\";\r\n\r\ninterface Usuario {\r\n    nick: string;\r\n    nombre: string;\r\n    email: string;\r\n    centro: string;\r\n    curso: string;\r\n    tipo: string;\r\n    fechaInscripcion: string;\r\n    likes: number;\r\n    amigos: string[];\r\n    respuestasAcertadas: number;\r\n    competicionesSuperadas: number;\r\n    concursosGanados: number;\r\n    comentariosRecibidos: number;\r\n    historiasCreadas: number;\r\n    anosEnStoryUp: number;\r\n    trofeos: unknown[];\r\n}\r\n\r\nfunction PerfilUsuario() {\r\n    const router = useRouter();\r\n    // FunciÃ³n para bloquear manualmente el trofeo 10 al usuario seleccionado\r\n    // FunciÃ³n para bloquear manualmente cualquier trofeo al usuario seleccionado\r\n    const handleLockTrofeo = async (trofeoIdx: number) => {\r\n        if (!selectedUser) return;\r\n        const updatedUsers = usuarios.map((u: User) =>\r\n            u.nick === selectedUser\r\n                ? {\r\n                    ...u,\r\n                    trofeosDesbloqueados: Array.isArray(u.trofeosDesbloqueados)\r\n                        ? u.trofeosDesbloqueados.filter((idx: number) => idx !== trofeoIdx)\r\n                        : [],\r\n                    trofeosBloqueados: Array.isArray(u.trofeosBloqueados)\r\n                        ? [...new Set([...(u.trofeosBloqueados || []), trofeoIdx])]\r\n                        : [trofeoIdx]\r\n                }\r\n                : u\r\n        );\r\n        setUsuarios(updatedUsers);\r\n\r\n        // Actualizar usuario en la base de datos\r\n        const updatedUser = updatedUsers.find((u: User) => u.nick === selectedUser);\r\n        if (updatedUser) {\r\n            await fetch('/api/users', {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    nick: selectedUser,\r\n                    trofeosDesbloqueados: updatedUser.trofeosDesbloqueados,\r\n                    trofeosBloqueados: updatedUser.trofeosBloqueados\r\n                })\r\n            });\r\n        }\r\n\r\n        // Si el usuario administrado es el actual, actualiza tambiÃ©n el estado y sessionStorage\r\n        if (user && user.nick === selectedUser && updatedUser) {\r\n            setUser({ ...user, trofeosDesbloqueados: updatedUser.trofeosDesbloqueados, trofeosBloqueados: updatedUser.trofeosBloqueados });\r\n            sessionStorage.setItem(\"user\", JSON.stringify({ ...user, trofeosDesbloqueados: updatedUser.trofeosDesbloqueados, trofeosBloqueados: updatedUser.trofeosBloqueados }));\r\n        }\r\n        // Disparar evento para refrescar la UI\r\n        window.dispatchEvent(new Event('storage'));\r\n        alert(`Trofeo #${trofeoIdx + 1} bloqueado manualmente para ${selectedUser}`);\r\n    };\r\n\r\n    // FunciÃ³n para asignar trofeos al usuario si su centro ganÃ³ premios este mes\r\n    const asignarTrofeosUsuario = async (usuario: Usuario) => {\r\n        if (typeof window === \"undefined\") return;\r\n\r\n        const fechaActual = new Date();\r\n        const year = fechaActual.getFullYear();\r\n        const month = fechaActual.getMonth() + 1;\r\n\r\n        const premios = await PremiosMensualesAPI.getPremiosMensuales(year, month);\r\n        const premioCentro = premios.find((p: unknown) => (p as { centro: string }).centro === usuario.centro);\r\n\r\n        if (premioCentro) {\r\n            let idTrofeo = 0;\r\n            switch ((premioCentro as { posicion: number }).posicion) {\r\n                case 1: idTrofeo = 25; break; // CampeÃ³n Mensual\r\n                case 2: idTrofeo = 26; break; // SubcampeÃ³n Mensual\r\n                case 3: idTrofeo = 27; break; // Tercer Lugar Mensual\r\n                default:\r\n                    if ((premioCentro as { posicion: number }).posicion <= 10) {\r\n                        idTrofeo = 28; // Top 10 Mensual\r\n                    } else {\r\n                        idTrofeo = 29; // Participante Activo\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (idTrofeo > 0 && !usuario.trofeos.includes(idTrofeo)) {\r\n                usuario.trofeos.push(idTrofeo);\r\n                // Actualizar usuario en la base de datos\r\n                await fetch('/api/users', {\r\n                    method: 'PUT',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        nick: usuario.nick,\r\n                        trofeos: usuario.trofeos\r\n                    })\r\n                });\r\n                // Mostrar notificaciÃ³n de nuevo trofeo\r\n                alert(`Â¡Felicitaciones! Has desbloqueado un nuevo trofeo: ${(premioCentro as { premio?: string }).premio || 'Premio'}`);\r\n            }\r\n        }\r\n    };\r\n\r\n    const [user, setUser] = useState<any>(null);\r\n    const [bullyingActivo, setBullyingActivo] = useState(false);\r\n    const [usuarioBullying, setUsuarioBullying] = useState(\"\");\r\n    const [palabraProhibida, setPalabraProhibida] = useState(\"\");\r\n    const [concursoTitulo, setConcursoTitulo] = useState(\"\");\r\n    const [concursoTexto, setConcursoTexto] = useState(\"\");\r\n    const [fechaInicio, setFechaInicio] = useState(\"\");\r\n    const [fechaFin, setFechaFin] = useState(\"\");\r\n    const [usuarioGanador, setUsuarioGanador] = useState(\"\");\r\n    const [concursoId, setConcursoId] = useState(1);\r\n    const [nombreArchivo, setNombreArchivo] = useState(\"\");\r\n    const [usuarios, setUsuarios] = useState<any[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState(\"\");\r\n    const [chatInput, setChatInput] = useState(\"\");\r\n    const [chatMessages, setChatMessages] = useState<{ from: string, to: string, text: string, fecha?: string }[]>([]);\r\n    const [mensajeRecibido, setMensajeRecibido] = useState(false);\r\n    const [noticiaTitulo, setNoticiaTitulo] = useState(\"\");\r\n    const [noticiaTexto, setNoticiaTexto] = useState(\"\");\r\n    const [noticiaImagen, setNoticiaImagen] = useState<string>(\"\");\r\n    // Estado para el trofeo seleccionado por el admin\r\n    const [trofeoSeleccionado, setTrofeoSeleccionado] = useState(\"\");\r\n    // Estados para gestionar concursos finalizados\r\n    const [concursoSeleccionado, setConcursoSeleccionado] = useState(\"\");\r\n    const [ganadorSeleccionado, setGanadorSeleccionado] = useState(\"\");\r\n    const [refreshKey, setRefreshKey] = useState(0);\r\n    const [concursos, setConcursos] = useState<any[]>([]);\r\n    // Estados para preguntas\r\n    const [cursoSeleccionado, setCursoSeleccionado] = useState<string>(\"1primaria\");\r\n    const [asignaturaSeleccionada, setAsignaturaSeleccionada] = useState<string>(\"matematicas\");\r\n    const [pregunta, setPregunta] = useState<string>(\"\");\r\n    const [respuesta, setRespuesta] = useState<string>(\"\");\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    const { t } = useTranslation();\r\n\r\n    // InicializaciÃ³n y sincronizaciÃ³n de usuario y rankings SOLO una vez\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!mounted) return;\r\n\r\n        const loadUsersAndRankings = async () => {\r\n            if (typeof window !== \"undefined\") {\r\n                // Cargar usuarios desde la API\r\n                try {\r\n                    const response = await fetch('/api/users');\r\n                    let usersArr = await response.json();\r\n                    if (!Array.isArray(usersArr)) usersArr = [];\r\n\r\n                    // Procesar usuarios\r\n                    let processedUsers = usersArr.map((u: User) => ({\r\n                        ...u,\r\n                        trofeosDesbloqueados: Array.isArray(u.trofeosDesbloqueados)\r\n                            ? (u.trofeosDesbloqueados as number[]).filter((idx: number) => idx !== 9)\r\n                            : []\r\n                    }));\r\n\r\n                    const userStr = sessionStorage.getItem(\"user\");\r\n                    if (userStr) {\r\n                        const userObj = JSON.parse(userStr);\r\n                        processedUsers = processedUsers.map((u: any) => {\r\n                            const amigosCount = Array.isArray(u.amigos) ? u.amigos.length : 0;\r\n                            return {\r\n                                ...u,\r\n                                trofeosDesbloqueados: Array.isArray(u.trofeosDesbloqueados)\r\n                                    ? u.trofeosDesbloqueados.filter((idx: number) => idx !== 9 || true)\r\n                                    : []\r\n                            };\r\n                        });\r\n\r\n                        // Rankings\r\n                        const rankingLikes = [...processedUsers].sort((a, b) => (b.likes || 0) - (a.likes || 0)).slice(0, 3).filter(u => (u.likes || 0) > 0);\r\n                        const rankingComentarios = [...processedUsers].sort((a, b) => (b.comentariosRecibidos || 0) - (a.comentariosRecibidos || 0)).slice(0, 3).filter(u => (u.comentariosRecibidos || 0) > 0);\r\n                        const rankingAmigos = [...processedUsers].sort((a, b) => (b.amigos || 0) - (a.amigos || 0)).slice(0, 3).filter(u => (u.amigos || 0) > 0);\r\n                        const rankingHistorias = [...processedUsers].sort((a, b) => (b.historias || 0) - (a.historias || 0)).slice(0, 3).filter(u => (u.historias || 0) > 0);\r\n                        const rankingConcursos = [...processedUsers].sort((a, b) => (b.concursosGanados || 0) - (a.concursosGanados || 0)).slice(0, 3).filter(u => (u.concursosGanados || 0) > 0);\r\n                        const rankingCompeticiones = [...processedUsers].sort((a, b) => (b.competicionesSuperadas || 0) - (a.competicionesSuperadas || 0)).slice(0, 3).filter(u => (u.competicionesSuperadas || 0) > 0);\r\n\r\n                        processedUsers = processedUsers.map((u: any) => ({\r\n                            ...u,\r\n                            estaEnRanking:\r\n                                rankingLikes.some(r => r.nick === u.nick) ||\r\n                                rankingComentarios.some(r => r.nick === u.nick) ||\r\n                                rankingAmigos.some(r => r.nick === u.nick) ||\r\n                                rankingHistorias.some(r => r.nick === u.nick) ||\r\n                                rankingConcursos.some(r => r.nick === u.nick) ||\r\n                                rankingCompeticiones.some(r => r.nick === u.nick),\r\n                            estaEnRankingCompeticiones:\r\n                                rankingCompeticiones.some(r => r.nick === u.nick)\r\n                        }));\r\n\r\n                        let userFromArr = processedUsers.find((u: any) => u.nick === userObj.nick);\r\n                        if (!userFromArr) userFromArr = userObj;\r\n                        if (userFromArr) {\r\n                            // Cargar amigos desde la API de amistades\r\n                            const amigosResponse = await fetch(`/api/amigos?nick=${encodeURIComponent(userObj.nick)}`);\r\n                            let amigosArr = [];\r\n                            if (amigosResponse.ok) {\r\n                                const amigosData = await amigosResponse.json();\r\n                                amigosArr = amigosData || [];\r\n                            }\r\n                            let competicionesSuperadas = userFromArr.competicionesSuperadas;\r\n                            if (typeof competicionesSuperadas !== 'number') {\r\n                                competicionesSuperadas = userObj.competicionesSuperadas || 0;\r\n                            }\r\n                            let trofeosDesbloqueados = userFromArr.trofeosDesbloqueados;\r\n                            const trofeosBloqueados = userFromArr.trofeosBloqueados || [];\r\n                            const amigosCount = Array.isArray(amigosArr) ? amigosArr.length : 0;\r\n                            if (Array.isArray(trofeosDesbloqueados)) {\r\n                                trofeosDesbloqueados = trofeosDesbloqueados.filter(idx => idx !== 9 || true);\r\n                            }\r\n                            const autoTrofeos = TROFEOS_AUTO\r\n                                .map((t, idx) => (typeof t.condicion === 'function' && t.condicion({ ...userFromArr, amigos: amigosArr })) ? idx : null)\r\n                                .filter((idx: number | null) => idx !== null);\r\n                            const usuarioActualizado = { ...userFromArr, amigos: amigosArr, competicionesSuperadas, estaEnRanking: userFromArr.estaEnRanking, trofeosDesbloqueados, trofeosBloqueados, autoTrofeos };\r\n                            setUser(usuarioActualizado);\r\n                            // Asignar trofeos si el centro ganÃ³ premios este mes\r\n                            asignarTrofeosUsuario(usuarioActualizado as Usuario);\r\n                        }\r\n                        setUsuarios(processedUsers);\r\n                        // No necesitamos guardar en localStorage ya que los datos estÃ¡n en la BD\r\n                    }\r\n                    // Cargar Ãºltimo ID de concurso desde la API\r\n                    const concursos = await ConcursosAPI.getConcursos();\r\n                    if (concursos.length > 0) {\r\n                        const concursosConId = concursos.filter(c => c.id !== undefined);\r\n                        if (concursosConId.length > 0) {\r\n                            const maxId = Math.max(...concursosConId.map(c => c.id!));\r\n                            setConcursoId(maxId + 1);\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error loading users and rankings:', error);\r\n                }\r\n            }\r\n        };\r\n        loadUsersAndRankings();\r\n    }, [mounted]);\r\n\r\n    // Cargar mensajes del chat y aviso solo cuando cambia el usuario\r\n    useEffect(() => {\r\n        if (user && user.nick) {\r\n            ChatAPI.getChat(user.nick).then(chatData => {\r\n                setChatMessages(chatData.messages || []);\r\n                setMensajeRecibido(chatData.aviso || false);\r\n            });\r\n        }\r\n    }, [user]);\r\n\r\n    // Escuchar cambios en el perfil\r\n    useEffect(() => {\r\n        const handleProfileUpdate = async () => {\r\n            try {\r\n                const users = await UsersAPI.getAllUsers();\r\n                if (!Array.isArray(users)) return; // Skip if not array\r\n                setUsuarios(users);\r\n                const userStr = sessionStorage.getItem(\"user\");\r\n                if (userStr) {\r\n                    const currentUser = JSON.parse(userStr);\r\n                    // Actualizar el usuario actual desde la BD si es necesario\r\n                    const updatedUser = users.find(u => u.nick === currentUser.nick);\r\n                    if (updatedUser) {\r\n                        setUser(updatedUser);\r\n                        sessionStorage.setItem(\"user\", JSON.stringify(updatedUser));\r\n                    } else {\r\n                        // Si no se encuentra en BD, mantener el user de sessionStorage\r\n                        setUser(currentUser);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('Error al actualizar perfil:', error);\r\n            }\r\n        };\r\n        window.addEventListener('profileUpdate', handleProfileUpdate);\r\n        window.addEventListener('storage', handleProfileUpdate);\r\n        return () => {\r\n            window.removeEventListener('profileUpdate', handleProfileUpdate);\r\n            window.removeEventListener('storage', handleProfileUpdate);\r\n        };\r\n    }, []);\r\n\r\n    // Cargar concursos desde la API\r\n    useEffect(() => {\r\n        const loadConcursos = async () => {\r\n            try {\r\n                const concursosData = await ConcursosAPI.getConcursos();\r\n                setConcursos(concursosData);\r\n            } catch (error) {\r\n                console.error('Error al cargar concursos:', error);\r\n            }\r\n        };\r\n        loadConcursos();\r\n    }, []);\r\n\r\n    const handlePalabraProhibidaSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        alert(`Palabra prohibida seleccionada: ${palabraProhibida}`);\r\n        setPalabraProhibida(\"\");\r\n    };\r\n    const handleApagarBullying = () => {\r\n        setBullyingActivo(false);\r\n        setUsuarioBullying(\"\");\r\n    };\r\n    const handleConcursoSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        try {\r\n            const nuevoConcurso = {\r\n                numero: concursoId,\r\n                titulo: concursoTitulo,\r\n                descripcion: concursoTexto,\r\n                fechaInicio: fechaInicio,\r\n                fechaFin: fechaFin,\r\n                ganador: usuarioGanador,\r\n                estado: 'activo' as const\r\n            };\r\n\r\n            await ConcursosAPI.createConcurso(nuevoConcurso);\r\n\r\n            setConcursoId(concursoId + 1);\r\n            setConcursoTitulo(\"\");\r\n            setConcursoTexto(\"\");\r\n            setFechaInicio(\"\");\r\n            setFechaFin(\"\");\r\n            setUsuarioGanador(\"\");\r\n            // Refrescar concursos en otras pÃ¡ginas\r\n            window.dispatchEvent(new Event('storage'));\r\n            alert(\"Concurso creado y ganador registrado\");\r\n        } catch (error) {\r\n            console.error('Error al crear concurso:', error);\r\n            alert('Error al crear el concurso. IntÃ©ntalo de nuevo.');\r\n        }\r\n    };\r\n    const handleSeleccionarGanador = async () => {\r\n        if (usuarioGanador) {\r\n            try {\r\n                // Actualizar el concurso mÃ¡s reciente con el ganador\r\n                const concursos = await ConcursosAPI.getConcursos();\r\n                if (concursos.length > 0) {\r\n                    const ultimoConcurso = concursos[0];\r\n                    await ConcursosAPI.updateConcurso(ultimoConcurso.id!, { ...ultimoConcurso, ganador: usuarioGanador });\r\n                }\r\n\r\n                // Sumar concursosGanados al usuario seleccionado\r\n                const winnerUser = usuarios.find(u => u.nick === usuarioGanador);\r\n                if (winnerUser) {\r\n                    const updatedWinner = { ...winnerUser, concursosGanados: (winnerUser.concursosGanados || 0) + 1 };\r\n                    await UsersAPI.updateUser(updatedWinner);\r\n\r\n                    const updatedUsers = usuarios.map(u =>\r\n                        u.nick === usuarioGanador ? updatedWinner : u\r\n                    );\r\n                    setUsuarios(updatedUsers);\r\n\r\n                    // Si el usuario actual es el ganador, actualizar tambiÃ©n el estado user\r\n                    if (user && user.nick === usuarioGanador) {\r\n                        setUser(updatedWinner);\r\n                        sessionStorage.setItem(\"user\", JSON.stringify(updatedWinner));\r\n                    }\r\n                }\r\n\r\n                // Refrescar perfil y concursos\r\n                window.dispatchEvent(new Event('profileUpdate'));\r\n                window.dispatchEvent(new Event('storage'));\r\n                alert(`Ganador seleccionado: ${usuarioGanador}`);\r\n            } catch (error) {\r\n                console.error('Error al seleccionar ganador:', error);\r\n                alert('Error al seleccionar el ganador. IntÃ©ntalo de nuevo.');\r\n            }\r\n        } else {\r\n            alert(\"Selecciona un usuario ganador\");\r\n        }\r\n    };\r\n    const handleAsignarGanador = async () => {\r\n        if (!concursoSeleccionado || !ganadorSeleccionado) {\r\n            alert(\"Selecciona un concurso y un ganador\");\r\n            return;\r\n        }\r\n        try {\r\n            // Actualizar el concurso seleccionado con el ganador\r\n            await ConcursosAPI.updateConcurso(parseInt(concursoSeleccionado), { ganador: ganadorSeleccionado });\r\n\r\n            // Sumar concursosGanados al usuario seleccionado\r\n            const winnerUser = usuarios.find(u => u.nick === ganadorSeleccionado);\r\n            if (winnerUser) {\r\n                const updatedWinner = { ...winnerUser, concursosGanados: (winnerUser.concursosGanados || 0) + 1 };\r\n                await UsersAPI.updateUser(updatedWinner);\r\n\r\n                const updatedUsers = usuarios.map(u =>\r\n                    u.nick === ganadorSeleccionado ? updatedWinner : u\r\n                );\r\n                setUsuarios(updatedUsers);\r\n\r\n                // Si el usuario actual es el ganador, actualizar tambiÃ©n el estado user\r\n                if (user && user.nick === ganadorSeleccionado) {\r\n                    setUser(updatedWinner);\r\n                    sessionStorage.setItem(\"user\", JSON.stringify(updatedWinner));\r\n                }\r\n            }\r\n\r\n            // Sumar 10 likes al ganador\r\n            await updateLikes(ganadorSeleccionado, 10);\r\n            // Limpiar selecciones\r\n            setConcursoSeleccionado('');\r\n            setGanadorSeleccionado('');\r\n            // Refrescar perfil y concursos\r\n            window.dispatchEvent(new Event('profileUpdate'));\r\n            window.dispatchEvent(new Event('storage'));\r\n            alert(`Ganador asignado a concurso ${concursoSeleccionado}: ${ganadorSeleccionado}`);\r\n            setConcursoSeleccionado(\"\");\r\n            setGanadorSeleccionado(\"\");\r\n            // Forzar re-render para actualizar la lista de concursos\r\n            setRefreshKey(prev => prev + 1);\r\n        } catch (error) {\r\n            console.error('Error al asignar ganador:', error);\r\n            alert('Error al asignar el ganador. IntÃ©ntalo de nuevo.');\r\n        }\r\n    };\r\n    const handleNoticiaSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setNoticiaTitulo(\"\");\r\n        setNoticiaTexto(\"\");\r\n        setNoticiaImagen(\"\");\r\n        alert(\"Noticia publicada (simulado)\");\r\n    };\r\n\r\n    // FunciÃ³n para enviar pregunta\r\n    const enviarPregunta = async () => {\r\n        if (!pregunta.trim() || !respuesta.trim()) {\r\n            alert(\"Por favor, completa la pregunta y la respuesta\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/api/add-question', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({\r\n                    curso: cursoSeleccionado,\r\n                    asignatura: asignaturaSeleccionada,\r\n                    pregunta: pregunta.trim(),\r\n                    respuesta: respuesta.trim(),\r\n                }),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (response.ok) {\r\n                alert(`Pregunta agregada exitosamente a ${asignaturaSeleccionada}-${cursoSeleccionado}.json\\n\\nPregunta: ${pregunta}\\nRespuesta: ${respuesta}`);\r\n                // Limpiar campos\r\n                setPregunta(\"\");\r\n                setRespuesta(\"\");\r\n            } else {\r\n                alert(`Error: ${data.error}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error al enviar pregunta:', error);\r\n            alert('Error al enviar la pregunta. IntÃ©ntalo de nuevo.');\r\n        }\r\n    };\r\n\r\n    // FunciÃ³n para aÃ±adir trofeo al usuario seleccionado\r\n    const handleAddTrofeo = async () => {\r\n        if (!selectedUser) return;\r\n        try {\r\n            const userToUpdate = usuarios.find(u => u.nick === selectedUser);\r\n            if (userToUpdate) {\r\n                const updatedUser = { ...userToUpdate, trofeos: (userToUpdate.trofeos || 0) + 1 };\r\n                await UsersAPI.updateUser(updatedUser);\r\n\r\n                const updatedUsers = usuarios.map(u =>\r\n                    u.nick === selectedUser ? updatedUser : u\r\n                );\r\n                setUsuarios(updatedUsers);\r\n\r\n                // Si el usuario actual es el seleccionado, actualizar tambiÃ©n el estado user\r\n                if (user && user.nick === selectedUser) {\r\n                    setUser(updatedUser);\r\n                    sessionStorage.setItem(\"user\", JSON.stringify(updatedUser));\r\n                }\r\n\r\n                alert(`Trofeo aÃ±adido a ${selectedUser}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error al aÃ±adir trofeo:', error);\r\n            alert('Error al aÃ±adir el trofeo. IntÃ©ntalo de nuevo.');\r\n        }\r\n    };\r\n    // FunciÃ³n general para sumar o restar likes a cualquier usuario\r\n    const updateLikes = async (nick: string, cantidad: number) => {\r\n        if (!nick) return;\r\n        const updatedUsers = usuarios.map(u =>\r\n            u.nick === nick\r\n                ? { ...u, likes: (u.likes || 0) + cantidad }\r\n                : u\r\n        );\r\n        setUsuarios(updatedUsers);\r\n\r\n        // Actualizar usuario en la base de datos\r\n        await fetch('/api/users', {\r\n            method: 'PUT',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                nick: nick,\r\n                likes: (updatedUsers.find(u => u.nick === nick)?.likes || 0)\r\n            })\r\n        });\r\n\r\n        // Si el usuario actual es el modificado, actualiza tambiÃ©n el estado user\r\n        if (user && user.nick === nick) {\r\n            const newLikes = (user.likes || 0) + cantidad;\r\n            setUser({ ...user, likes: newLikes });\r\n            sessionStorage.setItem(\"user\", JSON.stringify({ ...user, likes: newLikes }));\r\n        }\r\n        // Emitir evento 'storage' manualmente para refrescar otras pÃ¡ginas\r\n        window.dispatchEvent(new Event('storage'));\r\n    };\r\n    // FunciÃ³n para desbloquear trofeo especÃ­fico\r\n    const handleUnlockTrofeo = async (trofeoIdx: number) => {\r\n        if (!selectedUser) return;\r\n        try {\r\n            // Obtener el usuario seleccionado actualizado\r\n            const currentUser = usuarios.find(u => u.nick === selectedUser);\r\n            if (!currentUser) return;\r\n\r\n            const updatedTrofeosDesbloqueados = Array.isArray(currentUser.trofeosDesbloqueados)\r\n                ? [...new Set([...(currentUser.trofeosDesbloqueados || []), trofeoIdx])]\r\n                : [trofeoIdx];\r\n            const updatedTrofeosBloqueados = Array.isArray(currentUser.trofeosBloqueados)\r\n                ? currentUser.trofeosBloqueados.filter((idx: number) => idx !== trofeoIdx)\r\n                : [];\r\n\r\n            // Actualizar el usuario en la base de datos\r\n            const updatedUser = {\r\n                ...currentUser,\r\n                trofeosDesbloqueados: updatedTrofeosDesbloqueados,\r\n                trofeosBloqueados: updatedTrofeosBloqueados\r\n            };\r\n\r\n            await UsersAPI.updateUser(updatedUser);\r\n\r\n            // Actualizar el estado local\r\n            const updatedUsers = usuarios.map(u =>\r\n                u.nick === selectedUser ? updatedUser : u\r\n            );\r\n            setUsuarios(updatedUsers);\r\n\r\n            // Si el usuario administrado es el actual, actualiza tambiÃ©n el estado y sessionStorage\r\n            if (user && user.nick === selectedUser) {\r\n                setUser(updatedUser);\r\n                sessionStorage.setItem(\"user\", JSON.stringify(updatedUser));\r\n            }\r\n\r\n            // Disparar evento para refrescar la UI\r\n            window.dispatchEvent(new Event('storage'));\r\n            alert(`Trofeo #${trofeoIdx + 1} desbloqueado para ${selectedUser}`);\r\n        } catch (error) {\r\n            console.error('Error al desbloquear trofeo:', error);\r\n            alert('Error al desbloquear el trofeo. IntÃ©ntalo de nuevo.');\r\n        }\r\n    };\r\n\r\n    // Lista de trofeos normales (24)\r\n    const TROFEOS = [\r\n        { src: \"/trofeo1.jpg\", texto: \"Trofeo 1\", tipo: \"auto\" },\r\n        { src: \"/trofeo2.jpg\", texto: \"Trofeo 2\", tipo: \"auto\" },\r\n        { src: \"/trofeo3.jpg\", texto: \"Trofeo 3\", tipo: \"auto\" },\r\n        { src: \"/trofeo4.jpg\", texto: \"Trofeo 4\", tipo: \"auto\" },\r\n        { src: \"/trofeo5.jpg\", texto: \"Trofeo 5\", tipo: \"auto\" },\r\n        { src: \"/trofeo6.jpg\", texto: \"Trofeo 6\", tipo: \"auto\" },\r\n        { src: \"/trofeo7.jpg\", texto: \"Trofeo 7\", tipo: \"auto\" },\r\n        { src: \"/trofeo8.jpg\", texto: \"Trofeo 8\", tipo: \"auto\" },\r\n        { src: \"/trofeo9.jpg\", texto: \"Trofeo 9\", tipo: \"auto\" },\r\n        { src: \"/trofeo10.jpg\", texto: \"Trofeo 10\", tipo: \"auto\" },\r\n        { src: \"/trofeo11.jpg\", texto: \"Trofeo 11\", tipo: \"auto\" },\r\n        { src: \"/trofeo12.jpg\", texto: \"Trofeo 12\", tipo: \"auto\" },\r\n        { src: \"/trofeo13.png\", texto: \"Trofeo 13\", tipo: \"auto\" },\r\n        { src: \"/trofeo14.jpg\", texto: \"Trofeo 14\", tipo: \"auto\" },\r\n        { src: \"/trofeo15.jpg\", texto: \"Trofeo 15\", tipo: \"auto\" },\r\n        { src: \"/trofeo16.jpg\", texto: \"Trofeo 16\", tipo: \"auto\" },\r\n        { src: \"/trofeo17.jpg\", texto: \"Trofeo 17\", tipo: \"auto\" },\r\n        { src: \"/trofeo18.jpg\", texto: \"Trofeo 18\", tipo: \"auto\" },\r\n        { src: \"/trofeo19.jpg\", texto: \"Trofeo 19\", tipo: \"auto\" },\r\n        { src: \"/trofeo20.jpg\", texto: \"Trofeo 20\", tipo: \"auto\" },\r\n        { src: \"/trofeo21.jpg\", texto: \"Trofeo 21\", tipo: \"auto\" },\r\n        { src: \"/trofeo22.jpg\", texto: \"Trofeo 22\", tipo: \"auto\" },\r\n        { src: \"/trofeo23.jpg\", texto: \"Trofeo 23\", tipo: \"auto\" },\r\n        { src: \"/trofeo24.jpg\", texto: \"Trofeo 24\", tipo: \"auto\" },\r\n        { src: \"/trofeo1.jpg\", texto: \"ðŸ† CampeÃ³n Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo2.jpg\", texto: \"ðŸ¥ˆ SubcampeÃ³n Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo3.jpg\", texto: \"ðŸ¥‰ Tercer Lugar Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo4.jpg\", texto: \"ðŸ… Top 10 Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo5.jpg\", texto: \"ðŸ“š Participante Activo\", tipo: \"asignado\" }\r\n    ];\r\n    // Lista de trofeos premium (12)\r\n    // TROFEOS_PREMIUM ahora se importa desde trofeosPremiumImport.ts\r\n    // Trofeos automÃ¡ticos con condiciÃ³n\r\n    const TROFEOS_AUTO = [\r\n        { src: \"/trofeo1.jpg\", texto: \"Trofeo 1\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 10 },\r\n        { src: \"/trofeo2.jpg\", texto: \"Trofeo 2\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 1 },\r\n        { src: \"/trofeo3.jpg\", texto: \"Trofeo 3\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRealizados || 0) >= 1 },\r\n        { src: \"/trofeo4.jpg\", texto: \"Trofeo 4\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 1 },\r\n        { src: \"/trofeo5.jpg\", texto: \"Trofeo 5\", tipo: \"auto\", condicion: (user: any) => (user.preguntasAcertadas || 0) >= 20 },\r\n        { src: \"/trofeo6.jpg\", texto: \"Trofeo 6\", tipo: \"auto\", condicion: (user: any) => (user.competicionesSuperadas || 0) >= 1 },\r\n        { src: \"/trofeo7.jpg\", texto: \"Trofeo 7\", tipo: \"auto\", condicion: (user: any) => !!user.estaEnRanking },\r\n        { src: \"/trofeo8.jpg\", texto: \"Trofeo 8\", tipo: \"auto\", condicion: (user: any) => (user.concursosGanados || 0) >= 1 },\r\n        { src: \"/trofeo9.jpg\", texto: \"Trofeo 9\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 100 },\r\n        { src: \"/trofeo10.jpg\", texto: \"Trofeo 10\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 10 },\r\n        { src: \"/trofeo11.jpg\", texto: \"Trofeo 11\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 3 },\r\n        { src: \"/trofeo12.jpg\", texto: \"Trofeo 12\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRecibidos || 0) >= 3 },\r\n        { src: \"/trofeo13.png\", texto: \"Trofeo 13\", tipo: \"auto\", condicion: (user: any) => !!user.estaEnRankingCompeticiones },\r\n        { src: \"/trofeo14.jpg\", texto: \"Trofeo 14\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 500 },\r\n        { src: \"/trofeo15.jpg\", texto: \"Trofeo 15\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 30 },\r\n        { src: \"/trofeo16.jpg\", texto: \"Trofeo 16\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRecibidos || 0) >= 10 },\r\n        { src: \"/trofeo17.jpg\", texto: \"Trofeo 17\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 15 },\r\n        { src: \"/trofeo18.jpg\", texto: \"Trofeo 18\", tipo: \"auto\", condicion: (user: any) => (user.concursosGanados || 0) >= 3 },\r\n        { src: \"/trofeo19.jpg\", texto: \"Trofeo 19\", tipo: \"auto\", condicion: (user: any) => (user.preguntasAcertadas || 0) >= 1000 },\r\n        {\r\n            src: \"/trofeo20.jpg\", texto: \"Trofeo 20\", tipo: \"auto\", condicion: (user: any) => {\r\n                if (!user.fechaInscripcion) return false;\r\n                const fecha = new Date(user.fechaInscripcion);\r\n                const ahora = new Date();\r\n                const diff = ahora.getTime() - fecha.getTime();\r\n                return diff >= 365 * 24 * 60 * 60 * 1000; // 1 aÃ±o en ms\r\n            }\r\n        },\r\n        { src: \"/trofeo21.jpg\", texto: \"Trofeo 21\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 30 },\r\n        { src: \"/trofeo22.jpg\", texto: \"Trofeo 22\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 1000 },\r\n        { src: \"/trofeo23.jpg\", texto: \"Trofeo 23\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 50 }\r\n    ];\r\n    // Unificar todos los trofeos para el selector\r\n    const TROFEOS_ALL = [...TROFEOS, ...TROFEOS_PREMIUM];\r\n    // FunciÃ³n para obtener trofeos desbloqueados automÃ¡ticamente\r\n    const getAutoTrofeos = (user: any) => {\r\n        // Trofeo Premium 7: DiseÃ±ador del Futuro\r\n        // ...existing code...\r\n        // Asegurar que el campo amigos es siempre un array actualizado\r\n        const userSync = {\r\n            ...user,\r\n            amigos: Array.isArray(user.amigos) ? user.amigos : []\r\n        };\r\n        const autoTrofeos = TROFEOS_AUTO\r\n            .map((t, idx) => (typeof t.condicion === 'function' && t.condicion(userSync)) ? idx : null)\r\n            .filter(idx => idx !== null);\r\n\r\n        // Desbloqueo automÃ¡tico de trofeos premium\r\n        const esPremium = userSync.premium === true || userSync.isPremium === true || userSync.tipo === \"premium\";\r\n        const historiasCreadas = Array.isArray(userSync.historias) ? userSync.historias.length : (userSync.historiasCreadas || 0);\r\n        const preguntasAcertadas = userSync.preguntasAcertadas || 0;\r\n        // Trofeo Premium 1: Historiador Premium\r\n        if (esPremium && historiasCreadas >= 35) {\r\n            autoTrofeos.push(TROFEOS.length); // Ãndice del trofeo premium 1\r\n        }\r\n        // Trofeo Premium 2: Sabio Premium\r\n        if (esPremium && preguntasAcertadas >= 1200) {\r\n            autoTrofeos.push(TROFEOS.length + 1); // Ãndice del trofeo premium 2\r\n        }\r\n        // Trofeo Premium 3: Amigo Premium\r\n        const amigosCount = Array.isArray(userSync.amigos) ? userSync.amigos.length : 0;\r\n        if (esPremium && amigosCount >= 60) {\r\n            autoTrofeos.push(TROFEOS.length + 2); // Ãndice del trofeo premium 3\r\n        }\r\n        // Trofeo Premium 4: EspÃ­ritu NavideÃ±o Premium\r\n        let tieneHistoriaNavidad = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneHistoriaNavidad = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.titulo || !historia.fecha || !historia.modo) return false;\r\n                const tituloLower = historia.titulo.toLowerCase();\r\n                const esNavidad = tituloLower.includes(\"navidad\") || tituloLower.includes(\"navideÃ±o\") || tituloLower.includes(\"navideÃ±a\");\r\n                const fecha = new Date(historia.fecha);\r\n                const year = fecha.getFullYear();\r\n                // Rango: 20 diciembre a 6 enero (del aÃ±o siguiente)\r\n                const inicio = new Date(year, 11, 20); // 20 diciembre\r\n                const fin = new Date(year + 1, 0, 6, 23, 59, 59); // 6 enero\r\n                return historia.modo === \"My Live\" && esNavidad && fecha >= inicio && fecha <= fin;\r\n            });\r\n        }\r\n        if (esPremium && tieneHistoriaNavidad) {\r\n            autoTrofeos.push(TROFEOS.length + 3); // Ãndice del trofeo premium 4\r\n        }\r\n        // Trofeo Premium 5: Verano Dorado Premium\r\n        let tieneHistoriaVerano = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneHistoriaVerano = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.fecha || !historia.modo) return false;\r\n                const fecha = new Date(historia.fecha);\r\n                // Rango: 15 junio a 15 septiembre\r\n                const year = fecha.getFullYear();\r\n                const inicio = new Date(year, 5, 15); // 15 junio\r\n                const fin = new Date(year, 8, 15, 23, 59, 59); // 15 septiembre\r\n                return historia.modo === \"My Live\" && fecha >= inicio && fecha <= fin;\r\n            });\r\n        }\r\n        if (esPremium && tieneHistoriaVerano) {\r\n            autoTrofeos.push(TROFEOS.length + 4); // Ãndice del trofeo premium 5\r\n        }\r\n        // Trofeo Premium 6: Veterano Dorado\r\n        let mesesPremium = 0;\r\n        if (userSync.premiumInicio && userSync.premiumExpiracion) {\r\n            const inicio = new Date(userSync.premiumInicio);\r\n            const fin = new Date(userSync.premiumExpiracion);\r\n            // Calcular meses completos entre inicio y fin\r\n            mesesPremium = (fin.getFullYear() - inicio.getFullYear()) * 12 + (fin.getMonth() - inicio.getMonth());\r\n            // Si el dÃ­a de expiraciÃ³n es menor que el de inicio, restar un mes\r\n            if (fin.getDate() < inicio.getDate()) {\r\n                mesesPremium--;\r\n            }\r\n        }\r\n        if (esPremium && mesesPremium >= 6) {\r\n            autoTrofeos.push(TROFEOS.length + 5); // Ãndice del trofeo premium 6\r\n        }\r\n        // Trofeo Premium 7: DiseÃ±ador del Futuro\r\n        let tieneLogoStoryUp = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneLogoStoryUp = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.titulo || !historia.imagen) return false;\r\n                const tituloLower = historia.titulo.toLowerCase();\r\n                return tituloLower.includes(\"logo storyup\") && !!historia.imagen;\r\n            });\r\n        }\r\n        if (esPremium && tieneLogoStoryUp) {\r\n            autoTrofeos.push(TROFEOS.length + 6); // Ãndice del trofeo premium 7\r\n        }\r\n        // Trofeo Premium 8: Escritor Premium\r\n        if (esPremium && historiasCreadas >= 15) {\r\n            autoTrofeos.push(TROFEOS.length + 7); // Ãndice del trofeo premium 8\r\n        }\r\n\r\n        // Trofeo Premium 9: Competidor Premium\r\n        // Consigue al menos 30 trofeos (normales + premium)\r\n        const totalTrofeosDesbloqueados = Array.isArray(userSync.trofeosDesbloqueados) ? userSync.trofeosDesbloqueados.length : 0;\r\n        // Incluye los automÃ¡ticos calculados en esta funciÃ³n\r\n        const totalAutoTrofeos = autoTrofeos.length;\r\n        const totalTrofeos = totalTrofeosDesbloqueados + totalAutoTrofeos;\r\n        if (esPremium && totalTrofeos >= 30) {\r\n            autoTrofeos.push(TROFEOS.length + 8); // Ãndice del trofeo premium 9\r\n        }\r\n        // Trofeo Premium 10: Cerebro de Oro\r\n        // 2500+ preguntas acertadas en Aprende con Pipo\r\n        if (esPremium && preguntasAcertadas >= 2500) {\r\n            autoTrofeos.push(TROFEOS.length + 9); // Ãndice del trofeo premium 10\r\n        }\r\n\r\n        // Trofeo Premium 11: Analista Premium\r\n        // Consigue nivel 3 en todas las materias en \"Analisis por materias\" de EstadÃ­sticas premium Avanzadas\r\n        // Suponemos que user.nivelesMaterias es un objeto tipo { matematicas: 3, lenguaje: 3, ... }\r\n        const materiasRequeridas = [\"matematicas\", \"lenguaje\", \"ciencias\", \"ingles\", \"historia\", \"geografia\", \"literatura\"];\r\n        const nivelesMaterias = userSync.nivelesMaterias || {};\r\n        const todasNivel3 = materiasRequeridas.every(m => nivelesMaterias[m] >= 3);\r\n        if (esPremium && todasNivel3) {\r\n            autoTrofeos.push(TROFEOS.length + 10); // Ãndice del trofeo premium 11\r\n        }\r\n        // Trofeo Premium 12: Red Social Premium\r\n        // Conseguir 100+ amigos\r\n        if (esPremium && amigosCount >= 100) {\r\n            autoTrofeos.push(TROFEOS.length + 11); // Ãndice del trofeo premium 12\r\n        }\r\n        return autoTrofeos;\r\n    };\r\n    // FunciÃ³n para saber si un trofeo estÃ¡ desbloqueado\r\n    const isTrofeoUnlocked = (user: any, idx: number) => {\r\n        const auto = getAutoTrofeos(user);\r\n        const manual = Array.isArray(user.trofeosDesbloqueados) ? user.trofeosDesbloqueados : [];\r\n        const bloqueados = Array.isArray(user.trofeosBloqueados) ? user.trofeosBloqueados : [];\r\n        const asignados = Array.isArray(user.trofeos) ? user.trofeos : [];\r\n        return (auto.includes(idx) || manual.includes(idx) || asignados.includes(idx)) && !bloqueados.includes(idx);\r\n    };\r\n\r\n    if (!user) {\r\n        return (\r\n            <div className=\"min-h-screen bg-green-100 flex items-center justify-center\">\r\n                <div className=\"max-w-md w-full bg-white shadow rounded p-6 text-center\">\r\n                    <h2 className=\"text-2xl font-bold mb-4\">Perfil</h2>\r\n                    <p className=\"text-gray-600\">No se ha iniciado sesiÃ³n.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    const displayedUser = selectedUser ? usuarios.find(u => u.nick === selectedUser) || user : user;\r\n\r\n    const isPremium = displayedUser ? displayedUser.premium === true : false;\r\n\r\n    if (!mounted) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div className=\"min-h-screen bg-green-100 flex flex-col pt-4\">\r\n                <div className=\"flex items-center justify-center mt-2 mb-4\">\r\n                    {mensajeRecibido && (\r\n                        <button\r\n                            className=\"bg-yellow-400 text-white px-2 py-1 rounded font-bold mr-4 animate-bounce\"\r\n                            onClick={() => {\r\n                                setMensajeRecibido(false);\r\n                                // No necesitamos remover de localStorage ya que se maneja en la BD\r\n                            }}\r\n                        >Mensaje recibido</button>\r\n                    )}\r\n                    <h2 className=\"text-3xl font-bold text-center\">Perfil de {renderNick(displayedUser.nick)}</h2>\r\n\r\n                    {/* Indicador Premium Animado */}\r\n                    {isPremium && (\r\n                        <div className=\"flex justify-center mt-2\">\r\n                            <div className=\"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 text-white px-6 py-2 rounded-full font-bold text-lg shadow-lg shadow-yellow-500/50 animate-pulse flex items-center gap-2\">\r\n                                <span className=\"animate-bounce\">ðŸ‘‘</span>\r\n                                <span>PREMIUM ACTIVO</span>\r\n                                <span className=\"animate-bounce\">âœ¨</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex flex-row w-full\">\r\n                    {/* Datos personales */}\r\n                    <div className={`max-w-md w-full bg-white shadow rounded p-6 ml-8 transition-all duration-500 ${isPremium\r\n                        ? 'border-4 border-yellow-400 shadow-2xl shadow-yellow-400/50 animate-pulse relative overflow-hidden'\r\n                        : ''\r\n                        }`}>\r\n                        {/* Efecto de partÃ­culas para premium */}\r\n                        {isPremium && (\r\n                            <div className=\"absolute inset-0 pointer-events-none\">\r\n                                <div className=\"absolute top-2 right-2 w-2 h-2 bg-yellow-400 rounded-full animate-ping opacity-75\"></div>\r\n                                <div className=\"absolute top-4 left-4 w-1 h-1 bg-yellow-300 rounded-full animate-bounce opacity-60\"></div>\r\n                                <div className=\"absolute bottom-4 right-6 w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse opacity-80\"></div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex justify-between items-center mb-4 relative\">\r\n                            <h3 className={`text-xl font-bold text-center w-full transition-all duration-300 ${isPremium ? 'text-yellow-600' : ''\r\n                                }`}>\r\n                                {t('informacionPersonal')}\r\n                                {isPremium && (\r\n                                    <span className=\"ml-2 animate-spin\">ðŸ‘‘</span>\r\n                                )}\r\n                            </h3>\r\n                        </div>                        <div className=\"flex flex-col items-center mb-4\">\r\n                            <div className={`relative ${isPremium ? '' : ''}`}>\r\n                                <img\r\n                                    src={displayedUser.avatar || \"/avatars/simple1.png\"}\r\n                                    alt=\"Avatar\"\r\n                                    className={`w-20 h-20 rounded-full mb-2 transition-all duration-300 ${isPremium\r\n                                        ? 'ring-4 ring-yellow-400 ring-opacity-70 shadow-lg shadow-yellow-400/50 hover:scale-110'\r\n                                        : ''\r\n                                        }`}\r\n                                />\r\n                                {isPremium && (\r\n                                    <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center text-xs animate-bounce\">\r\n                                        âœ¨\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <button className={`px-4 py-2 rounded font-semibold transition-all duration-300 ${isPremium\r\n                                ? 'bg-gradient-to-r from-yellow-500 to-yellow-600 text-white hover:from-yellow-600 hover:to-yellow-700 shadow-lg hover:shadow-yellow-500/50 hover:scale-105'\r\n                                : 'bg-blue-500 text-white hover:bg-blue-600'\r\n                                }`} onClick={() => router.push('/perfil/avatar')}>\r\n                                Cambiar avatar\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"mb-2\"><strong>{t('nombre')}:</strong> {displayedUser.nombre}</div>\r\n                        <div className=\"mb-2\"><strong>Nick:</strong> {renderNick(displayedUser.nick)}</div>\r\n                        <div className=\"mb-2\"><strong>{t('email')}:</strong> {displayedUser.email}</div>\r\n                        <div className=\"mb-2\"><strong>{t('centroEducativo')}:</strong> {displayedUser.centro}</div>\r\n                        <div className=\"mb-2\"><strong>{t('curso')}:</strong> {displayedUser.curso}</div>\r\n                        <div className=\"mb-2\"><strong>{t('tipoUsuario')}:</strong> {user.tipo}</div>\r\n                        <div className=\"mb-2\"><strong>{t('fechaInscripcion')}:</strong> {user.fechaInscripcion ? new Date(user.fechaInscripcion).toLocaleDateString('es-ES') : ''}</div>\r\n                        <div className=\"mb-2 flex items-center\">\r\n                            {/* Datos personales en filas de dos en dos, con bloques redondos */}\r\n                            <div className=\"flex flex-col mt-2 gap-y-4\">\r\n                                <div className=\"flex flex-row gap-x-12\">\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ‘</span>\r\n                                        <strong>Likes:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-300 text-green-900 font-bold text-sm\">{displayedUser.likes || 0}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center ml-8\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ‘¥</span>\r\n                                        <strong>{t('totalAmigos')}:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-300 text-blue-900 font-bold text-sm\">{displayedUser.amigos ? displayedUser.amigos.length : 0}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex flex-row gap-x-12\">\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ“–</span>\r\n                                        <strong>{t('totalHistorias')}:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-purple-200 text-purple-900 font-bold text-sm\">{displayedUser.historias ? displayedUser.historias.length : 0}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ’¬</span>\r\n                                        <strong>{t('totalComentarios')}:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-yellow-200 text-yellow-900 font-bold text-sm\">{displayedUser.comentariosRecibidos || 0}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex flex-row gap-x-12\">\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ†</span>\r\n                                        <strong>{t('trofeosDesbloqueados')}:</strong>\r\n                                        {(() => {\r\n                                            // Trofeos automÃ¡ticos\r\n                                            const auto = getAutoTrofeos(displayedUser);\r\n                                            // Manuales\r\n                                            const manual = Array.isArray(displayedUser.trofeosDesbloqueados) ? displayedUser.trofeosDesbloqueados : [];\r\n                                            // Asignados (por competiciones, etc.)\r\n                                            const asignados = Array.isArray(displayedUser.trofeos) ? displayedUser.trofeos : [];\r\n                                            // Premium\r\n                                            const premiumCount = manual.filter((idx: number) => idx >= TROFEOS.length && idx < TROFEOS.length + TROFEOS_PREMIUM.length).length;\r\n                                            // Unir todos y contar Ãºnicos\r\n                                            const total = new Set([...auto, ...manual, ...asignados]).size + premiumCount;\r\n                                            return (\r\n                                                <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-pink-200 text-pink-900 font-bold text-sm\">{total}</span>\r\n                                            );\r\n                                        })()}\r\n                                    </div>\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">âœ…</span>\r\n                                        <strong>Respuestas acertadas:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-indigo-200 text-indigo-900 font-bold text-sm\">{user.preguntasAcertadas || 0}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex flex-row gap-x-12\">\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸ¥‡</span>\r\n                                        <strong>Competiciones:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-teal-200 text-teal-900 font-bold text-sm\">{displayedUser.competicionesSuperadas || 0}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center\">\r\n                                        <span className=\"mr-2 text-lg\">ðŸŽ‰</span>\r\n                                        <strong>Concursos:</strong>\r\n                                        <span className=\"ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full bg-red-200 text-red-900 font-bold text-sm\">{displayedUser.concursosGanados || 0}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col flex-1 ml-8\">\r\n                        <div className=\"flex flex-row gap-4\">\r\n                            {/* Trofeos */}\r\n                            <div className=\"max-w-md w-full bg-white shadow rounded p-6\">\r\n                                <h3 className=\"text-xl font-bold mb-4 text-center\">{t('trofeosDesbloqueados')}</h3>\r\n                                <div className=\"grid grid-cols-6 gap-2\">\r\n                                    {TROFEOS.map((trofeo, idx) => {\r\n                                        const tieneTrofeo = isTrofeoUnlocked(user, idx);\r\n                                        return (\r\n                                            <div key={idx} className={`relative bg-white rounded-lg shadow flex items-center justify-center w-14 h-14 border border-gray-200 ${tieneTrofeo ? '' : 'opacity-40'}`}>\r\n                                                <img src={trofeo.src} alt={trofeo.texto} className=\"w-10 h-10 object-contain\" />\r\n                                                {tieneTrofeo ? (\r\n                                                    <span className=\"absolute top-1 right-1 bg-yellow-200 text-xs font-bold rounded px-1 py-0.5\">{idx + 1}</span>\r\n                                                ) : (\r\n                                                    <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                                                        <svg width=\"56\" height=\"56\" viewBox=\"0 0 56 56\" className=\"absolute text-red-500\" style={{ zIndex: 2, left: 0, top: 0 }}>\r\n                                                            <line x1=\"0\" y1=\"0\" x2=\"56\" y2=\"56\" stroke=\"currentColor\" strokeWidth=\"6\" />\r\n                                                            <line x1=\"56\" y1=\"0\" x2=\"0\" y2=\"56\" stroke=\"currentColor\" strokeWidth=\"6\" />\r\n                                                        </svg>\r\n                                                        <svg width=\"48\" height=\"48\" viewBox=\"0 0 20 20\" fill=\"none\" className=\"text-yellow-500\">\r\n                                                            <rect x=\"2\" y=\"7\" width=\"16\" height=\"10\" rx=\"3\" fill=\"currentColor\" />\r\n                                                            <rect x=\"5\" y=\"2\" width=\"10\" height=\"7\" rx=\"5\" stroke=\"currentColor\" strokeWidth=\"2\" fill=\"none\" />\r\n                                                            <circle cx=\"10\" cy=\"13\" r=\"2\" fill=\"#fff\" />\r\n                                                        </svg>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                            {/* Trofeos Premium */}\r\n                            <div className={`max-w-md w-full bg-white shadow rounded p-6 transition-all duration-500 ${isPremium\r\n                                ? 'border-4 border-yellow-400 shadow-2xl shadow-yellow-400/50 animate-pulse relative overflow-hidden'\r\n                                : ''\r\n                                }`}>\r\n                                {/* Efectos premium para trofeos */}\r\n                                {isPremium && (\r\n                                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                                        <div className=\"absolute top-1 left-1 w-2 h-2 bg-yellow-400 rounded-full animate-ping opacity-60\"></div>\r\n                                        <div className=\"absolute bottom-2 right-2 w-1 h-1 bg-yellow-300 rounded-full animate-bounce opacity-70\"></div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <h3 className={`text-xl font-bold mb-4 text-center transition-all duration-300 ${isPremium ? 'text-yellow-600' : ''\r\n                                    }`}>\r\n                                    Trofeos Premium\r\n                                    {isPremium && <span className=\"ml-2 animate-spin\">ðŸ‘‘</span>}\r\n                                </h3>\r\n                                <div className=\"grid grid-cols-4 gap-4 w-full\">\r\n                                    {TROFEOS_PREMIUM.map((trofeo, idx) => {\r\n                                        const tieneTrofeo = isTrofeoUnlocked(user, TROFEOS.length + idx);\r\n                                        return (\r\n                                            <div key={idx} className={`relative bg-white rounded-lg shadow flex items-center justify-center w-20 h-20 border-2 border-yellow-400 ${tieneTrofeo ? '' : 'opacity-40'}`}>\r\n                                                <img src={trofeo.src} alt={`Premium ${idx + 1}`} className=\"w-16 h-16 object-contain\" />\r\n                                                {tieneTrofeo ? (\r\n                                                    <span className=\"absolute top-1 right-1 bg-yellow-300 text-sm font-bold rounded px-2 py-0.5\">{idx + 1}</span>\r\n                                                ) : (\r\n                                                    <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                                                        <svg width=\"72\" height=\"72\" viewBox=\"0 0 72 72\" className=\"absolute text-red-500\" style={{ zIndex: 2, left: 0, top: 0 }}>\r\n                                                            <line x1=\"0\" y1=\"0\" x2=\"72\" y2=\"72\" stroke=\"currentColor\" strokeWidth=\"8\" />\r\n                                                            <line x1=\"72\" y1=\"0\" x2=\"0\" y2=\"72\" stroke=\"currentColor\" strokeWidth=\"8\" />\r\n                                                        </svg>\r\n                                                        <svg width=\"64\" height=\"64\" viewBox=\"0 0 20 20\" fill=\"none\" className=\"text-yellow-500\">\r\n                                                            <rect x=\"2\" y=\"7\" width=\"16\" height=\"10\" rx=\"3\" fill=\"currentColor\" />\r\n                                                            <rect x=\"5\" y=\"2\" width=\"10\" height=\"7\" rx=\"5\" stroke=\"currentColor\" strokeWidth=\"2\" fill=\"none\" />\r\n                                                            <circle cx=\"10\" cy=\"13\" r=\"2\" fill=\"#fff\" />\r\n                                                        </svg>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        {/* Chat justo debajo de los trofeos, con ancho limitado */}\r\n                        <div className=\"flex flex-row justify-start mt-16\">\r\n                            <div className=\"bg-white shadow-lg rounded-lg p-6 flex flex-row items-start gap-6\" style={{ width: 'calc(2 * 28rem + 1rem)' }}>\r\n                                {/* 2 bloques de trofeos de max-w-md (28rem) + gap-4 (1rem) */}\r\n                                <div className=\"w-64 flex flex-col items-start\">\r\n                                    <label htmlFor=\"destinatario\" className=\"font-medium mb-2 text-sm\">Enviar a usuario:</label>\r\n                                    <select\r\n                                        id=\"destinatario\"\r\n                                        className=\"px-2 py-2 rounded border border-blue-300 bg-white w-full text-sm\"\r\n                                        value={selectedUser}\r\n                                        onChange={e => setSelectedUser(e.target.value)}\r\n                                    >\r\n                                        <option value=\"\">{t('seleccionarUsuario')}</option>\r\n                                        {usuarios\r\n                                            .filter((u, i, arr) => arr.findIndex(x => x.nick === u.nick) === i)\r\n                                            .sort((a, b) => a.nick.localeCompare(b.nick))\r\n                                            .map((u: any) => (\r\n                                                <option key={u.nick} value={u.nick}>{u.nick}</option>\r\n                                            ))}\r\n                                    </select>\r\n                                </div>\r\n                                <div className=\"flex-1 flex flex-col items-center\">\r\n                                    <div className=\"flex items-center mb-4\">\r\n                                        <h3 className=\"text-xl font-bold text-center flex-1\">Chat</h3>\r\n                                    </div>\r\n                                    <div className=\"w-full h-64 bg-gray-50 rounded-lg border border-gray-200 p-4 overflow-y-auto flex flex-col\">\r\n                                        {chatMessages.length === 0 ? (\r\n                                            <div className=\"flex-1 flex items-center justify-center text-gray-400\">El chat estarÃ¡ disponible aquÃ­.</div>\r\n                                        ) : (\r\n                                            chatMessages.map((msg, idx) => (\r\n                                                <div key={idx} className=\"mb-2 text-sm flex justify-between items-center\">\r\n                                                    <span>\r\n                                                        <strong>{msg.from === user.nick ? \"TÃº\" : msg.from} â†’ {msg.to === user.nick ? \"TÃº\" : msg.to}:</strong> {msg.text}\r\n                                                    </span>\r\n                                                    {msg.fecha && (\r\n                                                        <span className=\"ml-2 text-xs text-gray-500\">{msg.fecha}</span>\r\n                                                    )}\r\n                                                </div>\r\n                                            ))\r\n                                        )}\r\n                                        <div className=\"w-full mt-4 flex\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"flex-1 border rounded-l px-3 py-2 focus:outline-none\"\r\n                                                placeholder=\"Escribe un mensaje...\"\r\n                                                value={chatInput}\r\n                                                onChange={e => setChatInput(e.target.value)}\r\n                                                disabled={!selectedUser}\r\n                                            />\r\n                                            <button\r\n                                                className=\"bg-green-500 text-white px-4 py-2 rounded-r font-semibold\"\r\n                                                disabled={!selectedUser || !chatInput.trim()}\r\n                                                onClick={async () => {\r\n                                                    if (selectedUser && chatInput.trim() && user && user.nick) {\r\n                                                        try {\r\n                                                            const mensaje = {\r\n                                                                from: user.nick,\r\n                                                                to: selectedUser,\r\n                                                                text: chatInput,\r\n                                                                fecha: new Date().toLocaleString('es-ES')\r\n                                                            };\r\n\r\n                                                            // Obtener mensajes actuales del emisor\r\n                                                            const chatEmisor = await ChatAPI.getChat(user.nick);\r\n                                                            const mensajesEmisorActuales = chatEmisor.messages || [];\r\n                                                            const nuevosMensajesEmisor = [...mensajesEmisorActuales, mensaje];\r\n                                                            await ChatAPI.setChat(user.nick, nuevosMensajesEmisor, false);\r\n\r\n                                                            // Obtener mensajes actuales del receptor\r\n                                                            const chatReceptor = await ChatAPI.getChat(selectedUser);\r\n                                                            const mensajesReceptorActuales = chatReceptor.messages || [];\r\n                                                            const nuevosMensajesReceptor = [...mensajesReceptorActuales, mensaje];\r\n                                                            await ChatAPI.setChat(selectedUser, nuevosMensajesReceptor, true);\r\n\r\n                                                            // Actualizar mensajes locales\r\n                                                            setChatMessages(nuevosMensajesEmisor.slice(-5));\r\n\r\n                                                            // Activar aviso para receptor (esto podrÃ­a manejarse en la API)\r\n                                                            // Forzar actualizaciÃ³n en la app del receptor\r\n                                                            window.dispatchEvent(new Event('storage'));\r\n\r\n                                                            setChatInput(\"\");\r\n                                                        } catch (error) {\r\n                                                            console.error('Error al enviar mensaje:', error);\r\n                                                            alert('Error al enviar el mensaje. IntÃ©ntalo de nuevo.');\r\n                                                        }\r\n                                                    }\r\n                                                }}\r\n                                            >{t('enviar')}</button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                {/* Solo los docentes ven los siguientes bloques debajo del chat */}\r\n                {user.tipo === \"docente\" && (\r\n                    <div className=\"w-full max-w-6xl mx-auto mt-20\">\r\n                        <div className=\"grid grid-cols-2 gap-12\">\r\n                            <div className=\"bg-white shadow-lg rounded-lg p-6\">\r\n                                <h3 className=\"text-xl font-bold text-center mb-2\">Crear noticia</h3>\r\n                                <form className=\"w-full flex flex-col gap-4\" onSubmit={handleNoticiaSubmit}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        className=\"border rounded px-3 py-2 w-full\"\r\n                                        placeholder=\"TÃ­tulo de la noticia\"\r\n                                        value={noticiaTitulo}\r\n                                        onChange={e => setNoticiaTitulo(e.target.value)}\r\n                                    />\r\n                                    <div className=\"relative w-full\">\r\n                                        <textarea\r\n                                            className=\"border rounded px-3 py-2 w-full min-h-[80px]\"\r\n                                            placeholder=\"Escribe la noticia aquÃ­...\"\r\n                                            value={noticiaTexto}\r\n                                            onChange={e => setNoticiaTexto(e.target.value)}\r\n                                        />\r\n                                        {noticiaImagen && (\r\n                                            <img src={noticiaImagen} alt=\"PrevisualizaciÃ³n\" className=\"absolute left-0 top-0 w-full h-full object-contain rounded shadow pointer-events-none\" style={{ zIndex: 1, opacity: 0.7 }} />\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-4 mt-2\">\r\n                                        <input\r\n                                            id=\"noticia-imagen\"\r\n                                            type=\"file\"\r\n                                            accept=\"image/*\"\r\n                                            className=\"hidden\"\r\n                                            onChange={e => {\r\n                                                const file = e.target.files?.[0];\r\n                                                if (file) {\r\n                                                    setNombreArchivo(file.name);\r\n                                                    const reader = new FileReader();\r\n                                                    reader.onload = (ev) => {\r\n                                                        setNoticiaImagen(ev.target?.result as string);\r\n                                                    };\r\n                                                    reader.readAsDataURL(file);\r\n                                                } else {\r\n                                                    setNombreArchivo(\"\");\r\n                                                    setNoticiaImagen(\"\");\r\n                                                }\r\n                                            }}\r\n                                        />\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            className=\"bg-gray-200 text-gray-700 px-4 py-2 rounded font-semibold border\"\r\n                                            onClick={() => document.getElementById('noticia-imagen')?.click()}\r\n                                        >Seleccionar imagen</button>\r\n                                        <button type=\"submit\" className=\"bg-blue-500 text-white px-4 py-2 rounded font-semibold\">Publicar noticia</button>\r\n                                    </div>\r\n                                </form>\r\n                            </div>\r\n                            <div className=\"bg-white shadow-lg rounded-lg p-6\">\r\n                                <h3 className=\"text-xl font-bold text-center mb-2\">Crear concurso</h3>\r\n                                <form className=\"w-full flex flex-col gap-4\" onSubmit={handleConcursoSubmit}>\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"border rounded px-3 py-2 flex-1\"\r\n                                            placeholder={t('titulo')}\r\n                                            value={concursoTitulo}\r\n                                            onChange={e => setConcursoTitulo(e.target.value)}\r\n                                        />\r\n                                        <span className=\"text-sm text-gray-500\">ID: {concursoId}</span>\r\n                                    </div>\r\n                                    <textarea\r\n                                        className=\"border rounded px-3 py-2 w-full min-h-[80px]\"\r\n                                        placeholder={t('descripcion')}\r\n                                        value={concursoTexto}\r\n                                        onChange={e => setConcursoTexto(e.target.value)}\r\n                                    />\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"flex flex-col flex-1\">\r\n                                            <label className=\"text-sm mb-1\">{t('fechaInicio')}</label>\r\n                                            <input type=\"date\" className=\"border rounded px-3 py-2\" value={fechaInicio} onChange={e => setFechaInicio(e.target.value)} />\r\n                                        </div>\r\n                                        <div className=\"flex flex-col flex-1\">\r\n                                            <label className=\"text-sm mb-1\">{t('fechaFin')}</label>\r\n                                            <input type=\"date\" className=\"border rounded px-3 py-2\" value={fechaFin} onChange={e => setFechaFin(e.target.value)} />\r\n                                        </div>\r\n                                        <button type=\"submit\" className=\"bg-blue-500 text-white px-4 py-2 rounded font-semibold\">{t('enviar')}</button>\r\n                                    </div>\r\n                                </form>\r\n                            </div>\r\n                        </div>\r\n                        {/* GestiÃ³n de Concursos Finalizados - Solo para docentes */}\r\n                        <div className=\"w-full mt-6 pt-4 border-t border-gray-200\">\r\n                            <h4 className=\"text-lg font-semibold text-center mb-3 text-gray-700\">{t('gestionarConcursosFinalizados')}</h4>\r\n                            <div className=\"flex flex-col gap-3\">\r\n                                <select\r\n                                    className=\"border rounded px-3 py-2 text-sm\"\r\n                                    value={concursoSeleccionado}\r\n                                    onChange={e => setConcursoSeleccionado(e.target.value)}\r\n                                    key={`concurso-select-${refreshKey}`}\r\n                                >\r\n                                    <option value=\"\">{t('seleccionarConcurso')}</option>\r\n                                    {(() => {\r\n                                        const hoy = new Date();\r\n                                        return concursos\r\n                                            .filter((c: any) => {\r\n                                                if (!c.fin) return false;\r\n                                                const fechaFin = new Date(c.fin);\r\n                                                const ahora = new Date();\r\n                                                // Solo mostrar concursos del docente actual que hayan finalizado y sin ganador\r\n                                                return fechaFin < ahora && c.autor === user.nick && !c.ganador;\r\n                                            })\r\n                                            .map((c: any) => (\r\n                                                <option key={c.numero} value={c.numero}>\r\n                                                    {c.titulo} (ID: {c.numero}) - {c.ganador ? `Ganador: ${c.ganador}` : 'Sin ganador'}\r\n                                                </option>\r\n                                            ));\r\n                                    })()}\r\n                                </select>\r\n                                <select\r\n                                    className=\"border rounded px-3 py-2 text-sm\"\r\n                                    value={ganadorSeleccionado}\r\n                                    onChange={e => setGanadorSeleccionado(e.target.value)}\r\n                                >\r\n                                    <option value=\"\">{t('seleccionarGanador')}</option>\r\n                                    {usuarios.sort((a, b) => a.nick.localeCompare(b.nick)).map((u, idx) => (\r\n                                        <option key={idx} value={u.nick}>{u.nick}</option>\r\n                                    ))}\r\n                                </select>\r\n                                <button\r\n                                    className=\"bg-green-500 text-white px-4 py-2 rounded font-semibold text-sm\"\r\n                                    onClick={handleAsignarGanador}\r\n                                    disabled={!concursoSeleccionado || !ganadorSeleccionado}\r\n                                >\r\n                                    {t('asignarGanador')}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-white shadow-lg rounded-lg p-6 flex flex-col gap-4 mt-6\">\r\n                            <h3 className=\"text-xl font-bold text-center mb-2\">Agregar Pregunta - Aprende con Pipo</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-blue-700 mb-2\">Curso:</label>\r\n                                    <select\r\n                                        value={cursoSeleccionado}\r\n                                        onChange={(e) => setCursoSeleccionado(e.target.value)}\r\n                                        className=\"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"1primaria\">1Âº Primaria</option>\r\n                                        <option value=\"2primaria\">2Âº Primaria</option>\r\n                                        <option value=\"3primaria\">3Âº Primaria</option>\r\n                                        <option value=\"4primaria\">4Âº Primaria</option>\r\n                                        <option value=\"5primaria\">5Âº Primaria</option>\r\n                                        <option value=\"6primaria\">6Âº Primaria</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-blue-700 mb-2\">Asignatura:</label>\r\n                                    <select\r\n                                        value={asignaturaSeleccionada}\r\n                                        onChange={(e) => setAsignaturaSeleccionada(e.target.value)}\r\n                                        className=\"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"campeonato\">Campeonato</option>\r\n                                        <option value=\"general\">General</option>\r\n                                        <option value=\"matematicas\">MatemÃ¡ticas</option>\r\n                                        <option value=\"lenguaje\">Lenguaje</option>\r\n                                        <option value=\"literatura\">Literatura</option>\r\n                                        <option value=\"historia\">Historia</option>\r\n                                        <option value=\"geografia\">GeografÃ­a</option>\r\n                                        <option value=\"ingles\">InglÃ©s</option>\r\n                                        <option value=\"naturaleza\">Naturaleza</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-blue-700 mb-2\">Pregunta:</label>\r\n                                <textarea\r\n                                    value={pregunta}\r\n                                    onChange={(e) => setPregunta(e.target.value)}\r\n                                    placeholder=\"Escribe la pregunta aquÃ­...\"\r\n                                    className=\"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-20 resize-none\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-blue-700 mb-2\">Respuesta:</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={respuesta}\r\n                                    onChange={(e) => setRespuesta(e.target.value)}\r\n                                    placeholder=\"Escribe la respuesta aquÃ­...\"\r\n                                    className=\"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"text-center\">\r\n                                <button\r\n                                    onClick={enviarPregunta}\r\n                                    className=\"bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg font-bold hover:shadow-lg transform hover:scale-105 transition-all\"\r\n                                >\r\n                                    âœ… Enviar Pregunta\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"mt-4 p-3 bg-blue-100 border border-blue-300 rounded\">\r\n                                <p className=\"text-sm text-blue-800\">\r\n                                    <strong>ðŸ’¡ InformaciÃ³n:</strong> Las preguntas se agregan automÃ¡ticamente al archivo correspondiente\r\n                                    <code className=\"bg-blue-200 px-1 rounded\">{asignaturaSeleccionada}-{cursoSeleccionado}.json</code>\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n                {/* Panel de administraciÃ³n y antibullying solo para docentes */}\r\n                {\r\n                    user.tipo && user.tipo.toLowerCase() === \"docente\" && (\r\n                        <div className=\"w-full max-w-6xl mx-auto mt-16 bg-white shadow-lg rounded-lg p-6 flex flex-col items-center\">\r\n                            <div className=\"w-full\">\r\n                                <h3 className=\"text-xl font-bold mb-4 text-center\">{t('panelAdministracion')}</h3>\r\n                                <form className=\"w-full flex flex-col items-center gap-4\" onSubmit={handlePalabraProhibidaSubmit}>\r\n                                    <div className=\"flex w-full max-w-xs items-center gap-2\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"border rounded px-3 py-2 min-w-[280px] max-w-full\"\r\n                                            placeholder={t('palabraProhibida')}\r\n                                            value={palabraProhibida}\r\n                                            onChange={e => setPalabraProhibida(e.target.value)}\r\n                                        />\r\n                                        <button type=\"submit\" className=\"bg-red-500 text-white px-4 py-2 rounded font-semibold whitespace-nowrap\">Seleccionar</button>\r\n                                    </div>\r\n                                </form>\r\n                                <h4 className=\"text-lg font-semibold mt-6 text-center\">{t('sistemaAntibullying')}</h4>\r\n                                <div className=\"mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md text-gray-700 max-w-2xl mx-auto\">\r\n                                    <div className=\"flex flex-row items-start gap-8\">\r\n                                        <div className=\"flex-1\">\r\n                                            <p className=\"font-semibold mb-2\">{t('avisoAntibullying')}</p>\r\n                                            <ol className=\"list-decimal ml-6 space-y-1\">\r\n                                                <li>{t('historiasTerror')}</li>\r\n                                                <li>{t('perdidaLikes')}</li>\r\n                                                <li>{t('mensajesUsuario')}</li>\r\n                                                <li>{t('palabrasProhibidasChat')}</li>\r\n                                                <li>{t('actividadConsecutiva')}</li>\r\n                                            </ol>\r\n                                        </div>\r\n                                        <div className=\"flex flex-col items-center justify-center min-w-[180px]\">\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                className={`relative w-32 h-32 rounded-full font-bold text-white text-lg mb-2 transition-all flex items-center justify-center ${bullyingActivo ? 'bg-red-600 opacity-100 shadow-lg animate-blink' : 'bg-green-600 opacity-40'}`}\r\n                                                disabled={!bullyingActivo}\r\n                                                onClick={handleApagarBullying}\r\n                                            >\r\n                                                {bullyingActivo ? 'Aviso Antibullying' : t('sinPeligro')}\r\n                                                <span className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                                                    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 100 100\" className=\"opacity-70\">\r\n                                                        <line x1=\"10\" y1=\"10\" x2=\"90\" y2=\"90\" stroke=\"white\" strokeWidth=\"10\" />\r\n                                                        <line x1=\"90\" y1=\"10\" x2=\"10\" y2=\"90\" stroke=\"white\" strokeWidth=\"10\" />\r\n                                                    </svg>\r\n                                                </span>\r\n                                            </button>\r\n                                            {usuarioBullying && (\r\n                                                <div className=\"text-center text-red-700 font-semibold text-base\">{usuarioBullying}</div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n                {/* Bloque especial para PIPO68(Admin) */}\r\n                {\r\n                    user.nick === \"PIPO68\" && (\r\n                        <div className=\"w-full max-w-2xl mx-auto mt-16 bg-blue-50 border-l-4 border-blue-400 p-2 rounded-md text-blue-700\">\r\n                            <h4 className=\"text-lg font-bold text-center mb-2\">Solo para PIPO68(Admin)</h4>\r\n                            <div className=\"flex flex-col gap-2 items-center\">\r\n                                <label htmlFor=\"admin-user-select\" className=\"font-semibold\">Selecciona usuario:</label>\r\n                                <select\r\n                                    id=\"admin-user-select\"\r\n                                    className=\"border rounded px-3 py-2 w-full max-w-xs\"\r\n                                    value={selectedUser}\r\n                                    onChange={e => setSelectedUser(e.target.value)}\r\n                                >\r\n                                    <option value=\"\">Selecciona un usuario</option>\r\n                                    {usuarios\r\n                                        .filter((u, i, arr) => arr.findIndex(x => x.nick === u.nick) === i)\r\n                                        .sort((a, b) => a.nick.localeCompare(b.nick))\r\n                                        .map((u: any) => (\r\n                                            <option key={u.nick} value={u.nick}>{u.nick}</option>\r\n                                        ))}\r\n                                </select>\r\n                                <div className=\"flex gap-4 mt-1\">\r\n                                    <button\r\n                                        className=\"bg-pink-500 text-white px-4 py-2 rounded font-semibold\"\r\n                                        disabled={!selectedUser}\r\n                                        onClick={() => selectedUser && updateLikes(selectedUser, 1)}\r\n                                    >AÃ±adir like</button>\r\n                                </div>\r\n                                {/* Selector de trofeos para desbloquear */}\r\n                                <div className=\"flex flex-col gap-1 mt-2 w-full max-w-xs\">\r\n                                    <label className=\"font-semibold\">Desbloquear trofeo:</label>\r\n                                    <select\r\n                                        className=\"border-2 border-blue-500 bg-white rounded px-3 py-2\"\r\n                                        value={trofeoSeleccionado}\r\n                                        onChange={e => setTrofeoSeleccionado(e.target.value)}\r\n                                    >\r\n                                        <option value=\"\">Selecciona trofeo</option>\r\n                                        {TROFEOS.map((trofeo, idx) => (\r\n                                            <option key={\"normal-\" + (idx + 1)} value={\"normal-\" + (idx + 1)}>{`Trofeo #${idx + 1} - ${trofeo.texto}`}</option>\r\n                                        ))}\r\n                                        {TROFEOS_PREMIUM.map((trofeo, idx) => (\r\n                                            <option key={\"premium-\" + (idx + 1)} value={\"premium-\" + (idx + 1)}>{`Premium #${idx + 1} - ${trofeo.texto}`}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                    <button\r\n                                        className=\"bg-yellow-500 text-white px-4 py-2 rounded font-semibold mt-1\"\r\n                                        disabled={!selectedUser || trofeoSeleccionado === \"\"}\r\n                                        onClick={() => {\r\n                                            if (trofeoSeleccionado.startsWith(\"normal-\")) {\r\n                                                handleUnlockTrofeo(Number(trofeoSeleccionado.replace(\"normal-\", \"\")) - 1);\r\n                                            } else if (trofeoSeleccionado.startsWith(\"premium-\")) {\r\n                                                handleUnlockTrofeo(24 + Number(trofeoSeleccionado.replace(\"premium-\", \"\")) - 1);\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        Desbloquear trofeo\r\n                                    </button>\r\n                                    <button\r\n                                        className=\"bg-red-500 text-white px-4 py-2 rounded font-semibold mt-1\"\r\n                                        disabled={!selectedUser || trofeoSeleccionado === \"\"}\r\n                                        onClick={() => {\r\n                                            if (trofeoSeleccionado.startsWith(\"normal-\")) {\r\n                                                handleLockTrofeo(Number(trofeoSeleccionado.replace(\"normal-\", \"\")) - 1);\r\n                                            } else if (trofeoSeleccionado.startsWith(\"premium-\")) {\r\n                                                handleLockTrofeo(24 + Number(trofeoSeleccionado.replace(\"premium-\", \"\")) - 1);\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        Bloquear trofeo\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n            </div >\r\n        </>\r\n    );\r\n}\r\n\r\nexport default PerfilUsuario;\r\n","// Archivo para importar y transformar trofeos premium desde el JSON\r\nimport trofeosPremium from './trofeos-premium.json';\r\n\r\nexport const TROFEOS_PREMIUM = trofeosPremium.map(t => ({\r\n    src: t.imagen,\r\n    texto: `${t.titulo}\\n${t.descripcion}`,\r\n    tipo: 'manual'\r\n}));\r\n","// Utilidad para manejar premios mensuales con PostgreSQL\r\n\r\nexport interface PremioMensual {\r\n    id?: number;\r\n    nick: string;\r\n    puntos: number;\r\n    posicion: number;\r\n    mes: number;\r\n    year: number;\r\n    premio?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\nexport class PremiosMensualesAPI {\r\n    // Obtener premios mensuales\r\n    static async getPremiosMensuales(year: number, month: number): Promise<PremioMensual[]> {\r\n        try {\r\n            const response = await fetch(`/api/premios-mensuales?year=${year}&month=${month}`);\r\n            if (!response.ok) throw new Error('Error fetching premios mensuales');\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error getting premios mensuales:', error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    // Guardar premios mensuales\r\n    static async setPremiosMensuales(year: number, month: number, premios: PremioMensual[]): Promise<boolean> {\r\n        try {\r\n            const response = await fetch('/api/premios-mensuales', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ year, month, premios })\r\n            });\r\n            return response.ok;\r\n        } catch (error) {\r\n            console.error('Error saving premios mensuales:', error);\r\n            return false;\r\n        }\r\n    }\r\n}","// Utilidad para manejar mensajes de chat con PostgreSQL\r\n\r\nexport interface ChatMessage {\r\n    from: string;\r\n    to: string;\r\n    text: string;\r\n    fecha?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\nexport class ChatAPI {\r\n    // Obtener mensajes de chat de un usuario\r\n    static async getChat(nick: string): Promise<{ messages: ChatMessage[], aviso: boolean }> {\r\n        try {\r\n            const response = await fetch(`/api/chat?nick=${encodeURIComponent(nick)}`);\r\n            if (!response.ok) throw new Error('Error fetching chat');\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error getting chat:', error);\r\n            return { messages: [], aviso: false };\r\n        }\r\n    }\r\n\r\n    // Guardar mensajes de chat\r\n    static async setChat(nick: string, messages: ChatMessage[], aviso: boolean = false): Promise<boolean> {\r\n        try {\r\n            const response = await fetch('/api/chat', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ nick, mensajes: messages, aviso })\r\n            });\r\n            return response.ok;\r\n        } catch (error) {\r\n            console.error('Error saving chat:', error);\r\n            return false;\r\n        }\r\n    }\r\n}"],"names":[],"mappings":"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"}