module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},57259,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=({nick:a,className:d})=>{let[e,f]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=()=>{};b();let c=a=>{(a.key?.startsWith("premium_")||null===a.key)&&b()},d=c=>{c.detail.nick===a&&b()};return window.addEventListener("storage",c),window.addEventListener("premiumUpdate",d),()=>{window.removeEventListener("storage",c),window.removeEventListener("premiumUpdate",d)}},[a]);let g=(a||"").trim().toLowerCase();return a&&"anonimo"!==g&&"anÃ³nimo"!==g?(0,b.jsxs)("a",{href:`/perfil/${encodeURIComponent(a)}`,className:d||"text-blue-600 underline hover:text-blue-800",title:`Ver perfil de ${a}${e?" (Usuario Premium)":""}`,children:[a,e&&(0,b.jsx)("span",{className:"ml-1 inline-flex items-center",children:(0,b.jsx)("span",{className:"bg-gradient-to-r from-sky-100 to-blue-100 text-amber-900 text-xs px-2 py-1 rounded-full font-bold shadow-md border border-sky-300",title:"Usuario Premium",children:"ðŸ‘‘"})})]}):(0,b.jsx)("span",{className:d||"text-gray-500",children:a||"(sin nick)"})};function e(a,c){return(0,b.jsx)(d,{nick:a,className:c})}a.s(["renderNick",()=>e],57259)},36701,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(57259),e=a.i(50944);function f(){let a=(0,e.useParams)(),f=a?.id,[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(0),[o,p]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{if(f)try{let a=await fetch(`/api/historias/${f}`);if(a.ok){let b=await a.json();h(b),n(b.likes||0),l(b.comentarios||[]);let c=localStorage.getItem("user"),d="";if(c)try{let a=JSON.parse(c);d=a.nick||a.nombre||a.usuario||c}catch{console.error("Error al parsear el usuario desde localStorage:",c),d=""}let e=b.liked_by||[];p(e.includes(d))}else console.warn("No se encontrÃ³ la historia")}catch(a){console.error("Error fetching historia:",a)}})()},[f]);let q=async()=>{if(g){let a=localStorage.getItem("user"),b="";if(a)try{let c=JSON.parse(a);b=c.nick||c.nombre||c.usuario||a}catch{console.error("Error al parsear el usuario desde localStorage:",a),b=""}try{let a=await fetch("/api/historias",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:g.id,action:"like",usuario:b})});if(a.ok){let b=await a.json();n(b.likes),p(b.liked);let c=g.autor,d=localStorage.getItem("users");if(d&&c){let a=JSON.parse(d),e=a.findIndex(a=>a.nick===c);if(-1!==e){let d=(a[e].likes||0)+(b.liked?1:-1);a[e].likes=d,localStorage.setItem("users",JSON.stringify(a));let f=localStorage.getItem("user");if(f){let a=JSON.parse(f);a.nick===c&&(a.likes=d,localStorage.setItem("user",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:c,field:"likes",value:d}})))}}}}else console.error("Error updating like")}catch(a){console.error("Error:",a)}}},r=async()=>{if(!i.trim())return;let a=localStorage.getItem("usuarioActual"),b="";if(a)try{let c=JSON.parse(a);b=c.nick||c.nombre||c.usuario||a}catch{b=a}try{let a=await fetch("/api/historias",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:g.id,action:"comment",usuario:b,comentario:i})});if(a.ok){let b=await a.json();l(b.comentarios),j(""),((a,b)=>{let c=localStorage.getItem("users");if(c){let d=JSON.parse(c),e=d.findIndex(b=>b.nick===a);if(-1!==e){let c=d[e][b]||0;"number"==typeof c&&(d[e][b]=c+1,localStorage.setItem("users",JSON.stringify(d)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:a,field:b,value:d[e][b]}})))}}})(g.autor,"comentariosRecibidos")}else console.error("Error adding comment")}catch(a){console.error("Error:",a)}};return g?(0,b.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-2xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2",children:g.titulo}),(0,b.jsxs)("div",{className:"mb-2 text-gray-700",children:["Por: ",(0,d.renderNick)(g.autor)," | ",g.fecha]}),g.imagen&&(0,b.jsx)("img",{src:g.imagen,alt:"Imagen",className:"mb-4 max-h-64 rounded"}),(0,b.jsx)("div",{className:"border rounded p-4 mb-4 bg-gray-50",dangerouslySetInnerHTML:{__html:g.contenido}}),(0,b.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,b.jsx)("button",{className:`font-bold py-2 px-4 rounded ${o?"bg-gray-400":"bg-pink-500 hover:bg-pink-600 text-white"}`,onClick:q,children:o?`ðŸ’” (${m})`:`â¤ï¸ Like (${0===m?"0":m})`})}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h2",{className:"font-bold mb-2",children:"Comentarios"}),(0,b.jsx)("ul",{className:"mb-2",children:k.slice(-5).map((a,c)=>(0,b.jsxs)("li",{className:"border-b py-1 text-gray-800",children:[(0,b.jsx)("span",{children:a.texto}),(0,b.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:a.fecha})]},c))}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:i,onChange:a=>j(a.target.value),placeholder:"Escribe un comentario...",className:"border rounded px-2 py-1 flex-1"}),(0,b.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white font-bold px-4 rounded",onClick:r,children:"Comentar"})]})]})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:"Cargando historia..."})}a.s(["default",()=>f])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f180127a._.js.map