{"version":3,"sources":["turbopack:///[project]/src/app/centros-competencia/page.tsx","turbopack:///[project]/src/utils/normalizadores.ts"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useTranslation } from '@/utils/i18n';\r\nimport { normalizarValorPremio, normalizarEventoEspecial } from '@/utils/normalizadores';\r\nimport { renderNick } from \"@/utils/renderNick\";\r\nimport trofeos from \"../../data/trofeos.json\";\r\nimport trofeosPremium from \"../../data/trofeos-premium.json\";\r\n\r\ninterface Usuario {\r\n    nick: string;\r\n    nombre: string;\r\n    email: string;\r\n    centro: string;\r\n    curso: string;\r\n    tipo: string;\r\n    fechaInscripcion: string;\r\n    likes: number;\r\n    amigos: string[];\r\n    respuestasAcertadas: number;\r\n    competicionesSuperadas: number;\r\n    concursosGanados: number;\r\n    comentariosRecibidos: number;\r\n    historiasCreadas: number;\r\n    historias?: any[];\r\n    anosEnStoryUp: number;\r\n    trofeos: any[];\r\n}\r\n\r\ninterface CentroStats {\r\n    nombre: string;\r\n    estudiantes: number;\r\n    estudiantesActivos: number; // activos en √∫ltimos 7 d√≠as\r\n    respuestasCorrectas: number;\r\n    concursosGanados: number;\r\n    historiasCreadas: number;\r\n    interaccionesSociales: number; // likes + mensajes + amigos\r\n    diasConsecutivos: number;\r\n    puntajeTotal: number;\r\n    ranking: number;\r\n    medalla: string;\r\n}\r\n\r\nexport default function CentrosCompetencia() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [centros, setCentros] = useState<CentroStats[]>([]);\r\n    const [centrosAnuales, setCentrosAnuales] = useState<CentroStats[]>([]);\r\n    const [miCentro, setMiCentro] = useState<string>(\"\");\r\n    const [filtroMes, setFiltroMes] = useState<string>(\"actual\");\r\n    const [modoVisualizacion, setModoVisualizacion] = useState<\"actual\" | \"historico\" | \"anual\">(\"actual\");\r\n    const [mesSeleccionado, setMesSeleccionado] = useState<string>(\"\");\r\n    const fechaActual = new Date();\r\n    const { t } = useTranslation();\r\n    const [mesesDisponibles, setMesesDisponibles] = useState<string[]>([]);\r\n    const [historialGanadores, setHistorialGanadores] = useState<any[]>([]);\r\n    const [premiosDelMes, setPremiosDelMes] = useState<any[]>([]);\r\n    const [usuario, setUsuario] = useState<Usuario | null>(null);\r\n    const [allUsers, setAllUsers] = useState<Usuario[]>([]);\r\n\r\n    // ‚úÖ MODO VACACIONES: Estados para funcionalidades especiales\r\n    const [modoVacaciones, setModoVacaciones] = useState<boolean>(false);\r\n    const [tipoVacacion, setTipoVacacion] = useState<string>(\"\");\r\n    const [eventoEspecial, setEventoEspecial] = useState<any>(null);\r\n\r\n    // ‚úÖ COMPETENCIAS POR ASIGNATURA: Estados para filtros espec√≠ficos\r\n    const [asignaturaSeleccionada, setAsignaturaSeleccionada] = useState<string>(\"todas\");\r\n    const [hayDatosAsignatura, setHayDatosAsignatura] = useState<boolean>(true);\r\n    const [cursoSeleccionado, setCursoSeleccionado] = useState<string>(\"todos\");\r\n    const asignaturas = [\"todas\", \"Matem√°ticas\", \"Lenguaje\", \"Literatura\", \"Historia\", \"Geograf√≠a\", \"Naturaleza\", \"Ingl√©s\", \"General\"];\r\n    const cursos = [\"todos\", \"1¬∫ Primaria\", \"2¬∫ Primaria\", \"3¬∫ Primaria\", \"4¬∫ Primaria\", \"5¬∫ Primaria\", \"6¬∫ Primaria\"];\r\n\r\n    // ‚úÖ MODO VACACIONES: Funciones para detectar per√≠odos especiales\r\n    const detectarPeriodoVacaciones = (): { esVacacion: boolean; tipo: string; evento: any } => {\r\n        const ahora = new Date();\r\n        const mes = ahora.getMonth() + 1; // 1-12\r\n        const dia = ahora.getDate();\r\n        const a√±o = ahora.getFullYear();\r\n\r\n        // Per√≠odos de vacaciones escolares en Espa√±a\r\n        const vacaciones = [\r\n            { inicio: { mes: 6, dia: 15 }, fin: { mes: 9, dia: 15 }, tipo: \"Vacaciones de Verano\", emoji: \"üèñÔ∏è\", multiplicador: 1.5 },\r\n            { inicio: { mes: 12, dia: 20 }, fin: { mes: 1, dia: 7 }, tipo: \"Vacaciones de Navidad\", emoji: \"üéÑ\", multiplicador: 1.3 },\r\n            { inicio: { mes: 3, dia: 20 }, fin: { mes: 4, dia: 5 }, tipo: \"Vacaciones de Semana Santa\", emoji: \"üê∞\", multiplicador: 1.2 },\r\n            { inicio: { mes: 10, dia: 31 }, fin: { mes: 11, dia: 2 }, tipo: \"Puente de Halloween\", emoji: \"üéÉ\", multiplicador: 1.1 },\r\n            { inicio: { mes: 12, dia: 6 }, fin: { mes: 12, dia: 8 }, tipo: \"Puente de la Constituci√≥n\", emoji: \"üá™üá∏\", multiplicador: 1.1 }\r\n        ];\r\n\r\n        for (const vacacion of vacaciones) {\r\n            let enPeriodo = false;\r\n\r\n            if (vacacion.inicio.mes === vacacion.fin.mes) {\r\n                // Mismo mes\r\n                enPeriodo = mes === vacacion.inicio.mes && dia >= vacacion.inicio.dia && dia <= vacacion.fin.dia;\r\n            } else if (vacacion.inicio.mes === 12 && vacacion.fin.mes === 1) {\r\n                // Navidad (diciembre-enero)\r\n                enPeriodo = (mes === 12 && dia >= vacacion.inicio.dia) || (mes === 1 && dia <= vacacion.fin.dia);\r\n            } else {\r\n                // Meses diferentes\r\n                enPeriodo = (mes === vacacion.inicio.mes && dia >= vacacion.inicio.dia) ||\r\n                           (mes > vacacion.inicio.mes && mes < vacacion.fin.mes) ||\r\n                           (mes === vacacion.fin.mes && dia <= vacacion.fin.dia);\r\n            }\r\n\r\n            if (enPeriodo) {\r\n                return {\r\n                    esVacacion: true,\r\n                    tipo: vacacion.tipo,\r\n                    evento: vacacion\r\n                };\r\n            }\r\n        }\r\n\r\n        return { esVacacion: false, tipo: \"\", evento: null };\r\n    };\r\n\r\n    // ‚úÖ CHALLENGES ESPECIALES: Funci√≥n para obtener challenge actual\r\n    const obtenerChallengeActual = (): any => {\r\n        // L√≥gica simplificada para obtener challenge actual\r\n        return null; // Por ahora retornamos null\r\n    };\r\n\r\n    // ‚úÖ RANKINGS: Funciones para guardar y cargar rankings mensuales\r\n    const guardarRankingMensual = (centrosData: CentroStats[]) => {\r\n        // L√≥gica simplificada\r\n    };\r\n\r\n    const cargarRankingMensual = (a√±o: number, mes: number): CentroStats[] => {\r\n        // L√≥gica simplificada\r\n        return [];\r\n    };\r\n\r\n    const obtenerHistorialGanadores = () => {\r\n        // L√≥gica simplificada\r\n        return [];\r\n    };\r\n\r\n    const obtenerPremiosDelMes = () => {\r\n        // L√≥gica simplificada\r\n        return [];\r\n    };\r\n\r\n    // ‚úÖ CARGA DE DATOS PRINCIPAL\r\n    useEffect(() => {\r\n        const cargarDatos = async () => {\r\n            try {\r\n                // L√≥gica simplificada de carga de datos\r\n                setLoading(false);\r\n            } catch (error) {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        cargarDatos();\r\n    }, [modoVisualizacion, mesSeleccionado, asignaturaSeleccionada, cursoSeleccionado]);\r\n\r\n    // ‚úÖ DETECTAR EVENTOS ESPECIALES\r\n    useEffect(() => {\r\n        const periodoVacaciones = detectarPeriodoVacaciones();\r\n        setModoVacaciones(periodoVacaciones.esVacacion);\r\n        setTipoVacacion(periodoVacaciones.tipo);\r\n\r\n        let eventoNormalizado: any = null;\r\n        if (periodoVacaciones.esVacacion && periodoVacaciones.evento) {\r\n            eventoNormalizado = normalizarEventoEspecial({\r\n                nombre: periodoVacaciones.tipo,\r\n                descripcion: periodoVacaciones.evento.descripcion || \"\",\r\n                emoji: periodoVacaciones.evento.emoji || \"\",\r\n                tipo: \"vacacion\",\r\n                multiplicador: periodoVacaciones.evento.multiplicador || 1\r\n            });\r\n        }\r\n\r\n        const challengeActual = obtenerChallengeActual();\r\n        if (challengeActual && !periodoVacaciones.esVacacion) {\r\n            eventoNormalizado = normalizarEventoEspecial({\r\n                nombre: challengeActual.nombre || \"\",\r\n                descripcion: challengeActual.bonus || \"\",\r\n                emoji: challengeActual.emoji || \"\",\r\n                tipo: \"challenge\"\r\n            });\r\n        }\r\n\r\n        setEventoEspecial(eventoNormalizado);\r\n    }, []);\r\n\r\n    // Obtener el centro del usuario actual\r\n    const centroDelUsuario = centros.find(c => c.nombre === miCentro);\r\n\r\n    // Calcular la descripci√≥n del t√≠tulo\r\n    const mesActual = new Date().toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });\r\n    let descripcionTitulo = \"\";\r\n    if (asignaturaSeleccionada === \"todas\" && cursoSeleccionado === \"todos\") {\r\n        descripcionTitulo = `Competencia del mes de ${mesActual}`;\r\n    } else if (asignaturaSeleccionada !== \"todas\" && cursoSeleccionado === \"todos\") {\r\n        descripcionTitulo = hayDatosAsignatura\r\n            ? `Vista espec√≠fica de ${asignaturaSeleccionada} - ${mesActual}`\r\n            : `Estimaciones para ${asignaturaSeleccionada} (sin datos espec√≠ficos a√∫n) - ${mesActual}`;\r\n    } else if (asignaturaSeleccionada === \"todas\" && cursoSeleccionado !== \"todos\") {\r\n        descripcionTitulo = `Competencia del mes de ${mesActual} - ${cursoSeleccionado}`;\r\n    } else {\r\n        descripcionTitulo = hayDatosAsignatura\r\n            ? `Vista espec√≠fica de ${asignaturaSeleccionada} (${cursoSeleccionado}) - ${mesActual}`\r\n            : `Estimaciones para ${asignaturaSeleccionada} (${cursoSeleccionado}) - ${mesActual}`;\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n                    <p className=\"text-blue-600 font-semibold\">Cargando competencia entre centros...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-8\">\r\n            <div className=\"max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"text-center mb-8\">\r\n                    <h1 className=\"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-green-600 mb-4\">\r\n                        üè´ {t('leagueTitle')}\r\n                    </h1>\r\n                    <p className=\"text-lg text-gray-700 max-w-2xl mx-auto\">\r\n                        {t('leagueSubtitle')}\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Contenido simplificado */}\r\n                <div className=\"text-center\">\r\n                    <p>P√°gina en desarrollo...</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}","// Utilidades para normalizar datos que provienen de la API\r\n// Objetivo: evitar renderizar objetos directamente en JSX y mantener consistencia\r\n\r\ninterface PremioObject {\r\n    nombre?: string;\r\n    titulo?: string;\r\n    descripcion?: string;\r\n}\r\n\r\ninterface EventoEspecialObject {\r\n    nombre?: string;\r\n    descripcion?: string;\r\n    emoji?: string;\r\n    tipo?: string;\r\n    multiplicador?: unknown;\r\n    bonus?: string;\r\n}\r\n\r\nexport const normalizarValorPremio = (valor: unknown): string => {\r\n    if (valor == null) return \"\";\r\n    if (typeof valor === 'string') return valor;\r\n    if (typeof valor === 'number') return String(valor);\r\n    if (typeof valor === 'object') {\r\n        // Preferimos campos legibles: nombre > titulo > descripcion\r\n        // Si no hay ninguno, guardamos JSON como fallback.\r\n        const obj = valor as PremioObject;\r\n        return obj.nombre || obj.titulo || obj.descripcion || JSON.stringify(valor);\r\n    }\r\n    // Guardar algo sensato para otros tipos\r\n    return String(valor);\r\n};\r\n\r\nexport const normalizarEventoEspecial = (evento: unknown) => {\r\n    if (!evento) return null;\r\n    if (typeof evento === 'string') {\r\n        return { nombre: evento, descripcion: evento, emoji: '', tipo: '' };\r\n    }\r\n\r\n    if (typeof evento === 'object') {\r\n        const obj = evento as EventoEspecialObject;\r\n        return {\r\n            nombre: obj.nombre || obj.tipo || '',\r\n            descripcion: obj.descripcion || obj.bonus || '',\r\n            emoji: obj.emoji || '',\r\n            tipo: obj.tipo || '',\r\n            multiplicador: obj.multiplicador || null\r\n        };\r\n    }\r\n\r\n    return null;\r\n};\r\n"],"names":[],"mappings":"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"}