(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56095,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let a=({nick:e,className:a})=>{let[s,i]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let t=async()=>{if(e)try{let t=await fetch(`/api/premium?nick=${e}`);if(t.ok){let e=await t.json();i(e.isActive)}else i(!1)}catch(e){console.error("Error checking premium:",e),i(!1)}};t();let r=r=>{r.detail.nick===e&&t()};return window.addEventListener("premiumUpdate",r),()=>{window.removeEventListener("premiumUpdate",r)}},[e]);let o=(e||"").trim().toLowerCase();return e&&"anonimo"!==o&&"anÃ³nimo"!==o?(0,t.jsxs)("a",{href:`/perfil/${encodeURIComponent(e)}`,className:a||"text-blue-600 underline hover:text-blue-800",title:`Ver perfil de ${e}${s?" (Usuario Premium)":""}`,children:[e,s&&(0,t.jsx)("span",{className:"ml-1 inline-flex items-center",children:(0,t.jsx)("span",{className:"bg-gradient-to-r from-sky-100 to-blue-100 text-amber-900 text-xs px-2 py-1 rounded-full font-bold shadow-md border border-sky-300",title:"Usuario Premium",children:"ðŸ‘‘"})})]}):(0,t.jsx)("span",{className:a||"text-gray-500",children:e||"(sin nick)"})};function s(e,r){return(0,t.jsx)(a,{nick:e,className:r})}e.s(["renderNick",()=>s],56095)},18566,(e,t,r)=>{t.exports=e.r(76562)},76179,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(56095),s=e.i(18566);function i(){let e=(0,s.useParams)(),i=e?.id,[o,l]=(0,r.useState)(null),[n,c]=(0,r.useState)(""),[d,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(0),[p,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(i)try{let e=await fetch(`/api/historias/${i}`);if(e.ok){let t=await e.json();l(t),h(t.likes||0),m(t.comentarios||[]);let r=localStorage.getItem("user"),a="";if(r)try{let e=JSON.parse(r);a=e.nick||e.nombre||e.usuario||r}catch{console.error("Error al parsear el usuario desde localStorage:",r),a=""}let s=t.liked_by||[];g(s.includes(a))}else console.warn("No se encontrÃ³ la historia")}catch(e){console.error("Error fetching historia:",e)}})()},[i]);let f=async()=>{if(o){let e=localStorage.getItem("user"),t="";if(e)try{let r=JSON.parse(e);t=r.nick||r.nombre||r.usuario||e}catch{console.error("Error al parsear el usuario desde localStorage:",e),t=""}try{let e=await fetch("/api/historias",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o.id,action:"like",usuario:t})});if(e.ok){let t=await e.json();h(t.likes),g(t.liked);let r=o.autor,a=localStorage.getItem("users");if(a&&r){let e=JSON.parse(a),s=e.findIndex(e=>e.nick===r);if(-1!==s){let a=(e[s].likes||0)+(t.liked?1:-1);e[s].likes=a,localStorage.setItem("users",JSON.stringify(e));let i=localStorage.getItem("user");if(i){let e=JSON.parse(i);e.nick===r&&(e.likes=a,localStorage.setItem("user",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:r,field:"likes",value:a}})))}}}}else console.error("Error updating like")}catch(e){console.error("Error:",e)}}},x=async()=>{if(!n.trim())return;let e=localStorage.getItem("usuarioActual"),t="";if(e)try{let r=JSON.parse(e);t=r.nick||r.nombre||r.usuario||e}catch{t=e}try{let e=await fetch("/api/historias",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o.id,action:"comment",usuario:t,comentario:n})});if(e.ok){let t=await e.json();m(t.comentarios),c(""),((e,t)=>{let r=localStorage.getItem("users");if(r){let a=JSON.parse(r),s=a.findIndex(t=>t.nick===e);if(-1!==s){let r=a[s][t]||0;"number"==typeof r&&(a[s][t]=r+1,localStorage.setItem("users",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:e,field:t,value:a[s][t]}})))}}})(o.autor,"comentariosRecibidos")}else console.error("Error adding comment")}catch(e){console.error("Error:",e)}};return o?(0,t.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-2xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2",children:o.titulo}),(0,t.jsxs)("div",{className:"mb-2 text-gray-700",children:["Por: ",(0,a.renderNick)(o.autor)," | ",o.fecha]}),o.imagen&&(0,t.jsx)("img",{src:o.imagen,alt:"Imagen",className:"mb-4 max-h-64 rounded"}),(0,t.jsx)("div",{className:"border rounded p-4 mb-4 bg-gray-50",dangerouslySetInnerHTML:{__html:o.contenido}}),(0,t.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,t.jsx)("button",{className:`font-bold py-2 px-4 rounded ${p?"bg-gray-400":"bg-pink-500 hover:bg-pink-600 text-white"}`,onClick:f,children:p?`ðŸ’” (${u})`:`â¤ï¸ Like (${0===u?"0":u})`})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h2",{className:"font-bold mb-2",children:"Comentarios"}),(0,t.jsx)("ul",{className:"mb-2",children:d.slice(-5).map((e,r)=>(0,t.jsxs)("li",{className:"border-b py-1 text-gray-800",children:[(0,t.jsx)("span",{children:e.texto}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:e.fecha})]},r))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),placeholder:"Escribe un comentario...",className:"border rounded px-2 py-1 flex-1"}),(0,t.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white font-bold px-4 rounded",onClick:x,children:"Comentar"})]})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:"Cargando historia..."})}e.s(["default",()=>i])}]);