(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78841,e=>{"use strict";var t=e.i(43476),l=e.i(71645);function a(){let[e,a]=(0,l.useState)(""),[s,r]=(0,l.useState)(""),[i,o]=(0,l.useState)(""),[n,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(!1),[x,m]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),[f,j]=(0,l.useState)([]),y=(0,l.useRef)(null),N=e=>{let t=y.current;if(!t)return;let l=t.selectionStart,a=t.selectionEnd,i=s;"bold"===e?i=s.slice(0,l)+"<b>"+s.slice(l,a)+"</b>"+s.slice(a):"underline"===e&&(i=s.slice(0,l)+"<u>"+s.slice(l,a)+"</u>"+s.slice(a)),r(i)},v=async()=>{let t="",l=null;{let e=localStorage.getItem("usuarioActual");if(e)try{t=JSON.parse(e).nick||""}catch{t=""}if(!t){let e=localStorage.getItem("user");e&&(t=(l=JSON.parse(e)).nick||"")}}if(!d&&!t)return void alert("No se puede enviar la historia: no se ha detectado usuario. Inicia sesi贸n como docente o alumno.");{let e=localStorage.getItem("prohibitedWords");if(e){let l=JSON.parse(e),a=s.toLowerCase();if(l.filter(e=>a.includes(e)||a.includes(e+"a")||a.includes(e+"o")).length>0&&t){b(!0),setTimeout(()=>b(!1),3e4);let e=localStorage.getItem("users");if(e){let l=JSON.parse(e);l=l.map(e=>e.nick===t?{...e,likes:(e.likes||0)-10}:e),localStorage.setItem("users",JSON.stringify(l))}}}}let i={titulo:e,contenido:s,autor:d?"An贸nimo":t,imagen:n,concurso:h?x:""};try{let e=await fetch("/api/historias",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(e.ok){let s=await e.json();if(l&&t){let e=Array.isArray(l.historias)?l.historias:[];l.historias=[s.id,...e],localStorage.setItem("user",JSON.stringify(l));let a=localStorage.getItem("users");if(a){let e=JSON.parse(a);e=e.map(e=>e.nick===t?{...e,historias:[s.id,...Array.isArray(e.historias)?e.historias:[]]}:e),localStorage.setItem("users",JSON.stringify(e))}}alert("Historia enviada!"),a(""),r(""),c(null)}else alert("Error al enviar la historia")}catch(e){console.error("Error:",e),alert("Error al enviar la historia")}};return(0,t.jsxs)("div",{className:"min-h-screen bg-green-100 p-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Crea tu Historia"}),(0,t.jsxs)("div",{className:"flex w-full justify-center items-start gap-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 w-64 flex flex-col gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Modo de historia:"}),(0,t.jsxs)("select",{className:"w-full border rounded px-2 py-1",children:[(0,t.jsx)("option",{children:"Real"}),(0,t.jsx)("option",{children:"Ficticia"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Tipo de historia:"}),(0,t.jsxs)("select",{className:"w-full border rounded px-2 py-1",children:[(0,t.jsx)("option",{children:"Aventura"}),(0,t.jsx)("option",{children:"Coraz贸n"}),(0,t.jsx)("option",{children:"Terror"}),(0,t.jsx)("option",{children:"Ficci贸n"}),(0,t.jsx)("option",{children:"Educativa"}),(0,t.jsx)("option",{children:"My Live"}),(0,t.jsx)("option",{children:"Concurso"})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",className:"form-checkbox mr-2",checked:d,onChange:e=>u(e.target.checked)}),"Escribir en modo An贸nimo"]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"inline-flex items-center mt-2",children:[(0,t.jsx)("input",{type:"checkbox",className:"form-checkbox mr-2",checked:h,onChange:e=>p(e.target.checked)}),"Escribir en modo Concurso"]}),h&&(0,t.jsx)("input",{type:"text",placeholder:"N煤mero de concurso",className:"w-full border rounded px-2 py-1 mt-2",value:x,onChange:e=>m(e.target.value.replace(/[^0-9]/g,""))})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 flex-1 flex flex-col gap-6",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"text",placeholder:"T铆tulo de la historia",className:"w-full border rounded px-3 py-2 font-semibold text-lg mb-2",value:e,onChange:e=>a(e.target.value)}),h&&(0,t.jsx)("input",{type:"text",placeholder:"N潞 concurso",className:"border rounded px-2 py-1 w-24 text-center",value:x,onChange:e=>m(e.target.value.replace(/[^0-9]/g,""))})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded font-bold",title:"Negrita",onClick:()=>N("bold"),children:"B"}),(0,t.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded font-bold",title:"Subrayado",onClick:()=>N("underline"),children:"S"}),(0,t.jsxs)("label",{className:"bg-gray-200 px-2 py-1 rounded cursor-pointer font-bold",title:"Subir imagen",children:["",(0,t.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=()=>{c(e.result)},e.readAsDataURL(t)}}})]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsx)("div",{className:"w-full mb-2",children:(0,t.jsx)("textarea",{ref:y,placeholder:"Escribe tu historia aqu铆...",className:"w-full border rounded px-3 py-2 min-h-[120px] mb-2",value:s,onChange:e=>r(e.target.value),style:n?{resize:"vertical",backgroundImage:`url(${n})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",opacity:.95}:{resize:"vertical"}})})}),(0,t.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded self-end",onClick:v,children:"Enviar"})]})]}),g&&f.length>0&&(0,t.jsxs)("div",{className:"fixed top-8 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-4 rounded shadow-lg z-50 text-lg font-bold",children:["Palabra prohibida -10 likes de penalizaci贸n",(0,t.jsx)("br",{}),"Detectadas: ",f.join(", ")]})]})}e.s(["default",()=>a])}]);